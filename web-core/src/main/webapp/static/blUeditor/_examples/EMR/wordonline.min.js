/*!
 * wordonline
 */
!function() {
    !function() {
        function a() {
            var d, e, f, g, a = document.getElementsByTagName("script"), c = a[a.length - 1].src;
            return c ? (d = document.createElement("a"),
            d.href = c,
            d.href = d.href,
            e = d.protocol + "//" + d.hostname + (d.port && "80" != d.port ? ":" + d.port : ""),
            f = "/" == d.pathname.charAt(0) ? d.pathname : "/" + d.pathname,
            g = e + f,
            b(b(g))) : ""
        }
        function b(a) {
            return a = a.replace(/\/$/, ""),
            a.substr(0, a.lastIndexOf("/") + 1)
        }
        var c = "http://word.baidu.com/static/" //a()
          , d = b(c)
          , e = d + "server/";
        window.WO = {
            WO_URL: c,
            WO_ROOT_URL: d,
            WO_SERVER_URL: e,
            uploaderSwfUrl: c + "lib/webuploader/Uploader.swf",
            uploaderServerUrl: e + "controller.php?cmd=uploaddoc",
            uploaderFieldName: "upfile"
        }
    }(),
    function() {
        var a = {
            ui: {
                back: "返回",
                undo: "撤销",
                redo: "重做",
                quickvisit: {
                    edit: "编辑",
                    upload: "导入文档",
                    download: "下载",
                    "new": " 新建",
                    share: "分享",
                    menu: "文件",
                    feedback: "反馈问题"
                },
                tabs: {
                    idea: "思路",
                    appearence: "展现",
                    view: "视图"
                },
                menu: {
                    mainmenutext: "百度脑图",
                    newtab: "新建",
                    opentab: "打开",
                    savetab: "保存",
                    sharetab: "分享",
                    helptab: "帮助",
                    settingtab: "设置",
                    recenttab: "最近使用",
                    netdisktab: "百度云存储",
                    localtab: "本地文件",
                    drafttab: "草稿箱",
                    downloadtab: "导出到本地",
                    createsharetab: "当前脑图",
                    managesharetab: "已分享",
                    newheader: "新建脑图",
                    openheader: "打开",
                    saveheader: "保存到",
                    shareheader: "分享我的脑图"
                },
                mydocument: "我的文档",
                emptydir: "目录为空！",
                pickfile: "选择文件...",
                acceptfile: "支持的格式：{0}",
                dropfile: "或将文件拖至此处",
                unsupportedfile: "不支持的文件格式",
                untitleddoc: "未命名文档",
                errorloading: "加载失败：{0}",
                unknownreason: "可能是外星人篡改了代码...",
                overrideconfirm: "{0} 已存在，确认覆盖吗？",
                checklogin: "检查登录状态中...",
                loggingin: "正在登录...",
                recent: "最近打开",
                clearrecent: "清空",
                clearrecentconfirm: "确认清空最近文档列表？",
                cleardraft: "清空",
                cleardraftconfirm: "确认清空草稿箱？",
                login: "登录",
                logout: "注销",
                switchuser: "切换账户",
                userinfo: "个人信息",
                gotonetdisk: "我的网盘",
                requirelogin: '请 <a class="login-button">登录</a> 后使用',
                saveas: "保存为",
                filename: "文件名",
                fileformat: "保存格式",
                save: "保存",
                mkdir: "新建目录",
                newdir: "未命名目录"
            }
        };
        WO.getLang = function(b) {
            var e, d, c = a;
            for (b = (b || "").split("."),
            d = 0; (e = b[d++]) && (c = c[e],
            c); )
                ;
            return c
        }
    }(),
    function() {
        WO.utils = {
            openGetWin: function(a, b) {
                var c = $("<a>").attr("target", "_blank").width(0).height(0).css("clip", "rect(1px, 1px, 1px, 1px)")
                  , d = [];
                b && $.each(b, function(a, b) {
                    d.push(a + "=" + b)
                }),
                d.length && (a = a + "?" + d.join("&")),
                c.attr("href", a).appendTo(document.body),
                c[0].click(),
                setTimeout(function() {
                    c && c.remove()
                })
            },
            openPostWin: function(a, b) {
                var c = b.target || "_blank"
                  , d = $('<form id="open-post-win" action="' + a + '" target="' + c + '" method="post"></form>');
                b && $.each(b, function(a, b) {
                    "target" != a && $('<input name="' + a + '"/>').val(b).appendTo(d)
                }),
                d.css("display", "none").appendTo(document.body),
                d.submit(),
                setTimeout(function() {
                    d && d.remove()
                })
            },
            getParam: function() {
                var a;
                return function(b) {
                    if (!a) {
                        var c, d, e;
                        if (a = {},
                        e = location.hash.substr(1))
                            for (e = e.split("&"),
                            c = 0; c < e.length; c++)
                                d = e[c].split("="),
                                a[d[0]] = d[1]
                    }
                    return a[b]
                }
            }()
        }
    }(),
    function() {
        $.extend(WO, {
            isReady: function() {
                return 1 == WO.__isReady
            },
            render: function(a, b) {
                var c = UE.getEditor(b, {
                    toolbars: [["message", "editword"]],
                    initialStyle: "body{padding: 100px!important;overflow-x:hidden!important;}p{word-wrap:break-word;}p{text-align:justify;letter-spacing:.001cm}table td,table th{border-color:#444444!important;padding:2px 8px;}",
                    initialContent: "",
                    autoClearinitialContent: "true",
                    focus: !0,
                    enableDragUpload: !1,
                    zIndex: 10
                });
                c.ready(function() {
                    WO.initUI(),
                    WO.initRequester(),
                    WO.initToolbar(a, c),
                    WO.initMenu(a, c),
                    WO.initLogin(c),
                    WO.__isReady = !0,
                    WO.fire("ready")
                }),
                WO.ue = WO.editor = window.ue = c
            },
            initToolbar: function(a, b) {
                WO.toolbar = FUIToolbar.getToolbar(a, b),
                WO.fire("toolbarready", WO.toolbar)
            },
            ready: function(a) {
                WO.isReady() ? a.call() : WO.on("ready", a)
            }
        })
    }(),
    function() {
        var a, b;
        $.extend(WO, {
            showMsg: function(c) {
                $("#wordonline-filename").html(c.content),
                clearTimeout(a),
                clearTimeout(b),
                c.keepshow || (a = setTimeout(function() {
                    WO.hideMsg()
                }, c.timeout || 3e3)),
                /正在.*\.{3}/.test(c.content) && (b = setInterval(function() {
                    var a = $("#wordonline-filename").html();
                    /正在.*\.{1,3}/.test(a) ? (a = a.replace(/\.{1,3}$/, function(a) {
                        return [".", "..", "..."][a.length % 3]
                    }),
                    $("#wordonline-filename").html(a)) : clearTimeout(b)
                }, 500))
            },
            updateMsg: function(c) {
                $("#wordonline-filename").html(c.content),
                clearTimeout(a),
                clearTimeout(b),
                c.keepshow || (a = setTimeout(function() {
                    WO.hideMsg()
                }, c.timeout || 3e3)),
                /正在.*\.{3}/.test(c.content) && (b = setInterval(function() {
                    var a = $("#wordonline-filename").html();
                    /正在.*\.{1,3}/.test(a) ? (a = a.replace(/\.{1,3}$/, function(a) {
                        return [".", "..", "..."][a.length % 3]
                    }),
                    $("#wordonline-filename").html(a)) : clearTimeout(b)
                }, 500))
            },
            hideMsg: function() {
                var c, d, a = WO.doc.current(), b = a && a.path;
                b ? ($("#wordonline-filename").html((WO.isUnSave ? "* " : "") + b.substr(b.lastIndexOf("/") + 1)),
                c = 0 === b.indexOf(WO.basePath) ? b.substr(WO.basePath.length) : b,
                d = "#path=" + c,
                d != window.location.hash && (window.location.hash = encodeURI(d))) : $("#wordonline-filename").html("未命名文档")
            },
            message: function(a) {
                $("#wordonline-filename").html(a.content)
            },
            title: function(a) {
                $("#wordonline-filename").html(a);
                try {
                    document.title = a ? a + " - 百度Doc" : "百度Doc"
                } catch (b) {}
            }
        })
    }(),
    function() {
        function i(a, b) {
            return void 0 === a ? {
                fid: e,
                path: d
            } : (void 0 !== a && null !== a && (e = a),
            void 0 !== b && null !== b && (d = b),
            WO.editor.execCommand("serverparam", {
                fid: e,
                path: d
            }),
            WO.fire("doccurrentchange"),
            void 0)
        }
        function j(a) {
            a && (a = a.substr(a.lastIndexOf("/") + 1),
            a = a.substr(0, a.lastIndexOf(".")) || a,
            a && setTimeout(function() {
                WO.fire("searchonwenku", a)
            }, 2500))
        }
        var a = ""
          , b = ""
          , c = !1
          , d = ""
          , e = ""
          , f = 0
          , g = WO.WO_SERVER_URL + "controller.php"
          , h = function(a) {
            try {
                return UE.utils.str2json.apply(null , arguments)
            } catch (b) {
                return console && console.error(b, a),
                null
            }
        }
        ;
        $.extend(WO, {
            initRequester: function() {
                WO.editor && WO.editor.on("imageUploadSuccess", function(a, b) {
                    !e && b.fid && i(b.fid, b.path)
                })
            },
            doc: {
                create: function(a, b) {
                    b(a.html)
                },
                open: function(a, b) {
                    WO.addMask(),
                    WO.showMsg({
                        keepshow: !0,
                        content: "正在打开文档..."
                    }),
                    $.get(g, {
                        cmd: "opendoc",
                        fid: a.fid,
                        path: a.path
                    }, function(a) {
                        WO.removeMask();
                        var c = h(a);
                        c && "SUCCESS" == c.state && (c.html || c.bdjson) ? (i(c.fid, c.path),
                        WO.hideMsg()) : WO.updateMsg({
                            timeout: 3e3,
                            content: c && "SUCCESS" == c.state ? "文档没有内容!" : "文档打开失败!"
                        }),
                        b && b(c)
                    })
                },
                view: function(a, b) {
                    WO.addMask(),
                    WO.showMsg({
                        keepshow: !0,
                        content: "正在打开文档..."
                    }),
                    $.get(g, {
                        cmd: "viewdoc",
                        fid: a.fid,
                        path: a.path
                    }, function(a) {
                        WO.removeMask();
                        var c = h(a);
                        c && "SUCCESS" == c.state && (c.html || c.bdjson) ? (i(c.fid, c.path),
                        WO.hideMsg(),
                        j(c.path)) : WO.updateMsg({
                            timeout: 3e3,
                            content: c && "SUCCESS" == c.state ? "文档没有内容!" : "文档打开失败!"
                        }),
                        b && b(c)
                    })
                },
                save: function(j, k) {
                    WO.showMsg({
                        keepshow: !0,
                        content: "正在保存文档..."
                    }),
                    $.post(g + "?cmd=savedoc&fid=" + e + "&path=" + d + "&newpath=" + (j.newpath || d) + "&docid=" + a + (c ? "&path=" + b : ""), {
                        content: j.content
                    }, function(a) {
                        var b = h(a);
                        b && "SUCCESS" == b.state ? (i(b.fid, b.path),
                        WO.isUnSave = !1,
                        WO.hideMsg()) : (WO.isUnSave = !0,
                        WO.updateMsg({
                            timeout: 3e3,
                            content: "文档保存失败!"
                        }),
                        f = 0),
                        k && k(b)
                    })
                },
                upload: function(a) {
                    WO.showMsg({
                        keepshow: !0,
                        content: "文档正在上传..."
                    }),
                    $(document.body).addClass("loading");
                    var c = function(b, e) {
                        $(document.body).removeClass("loading");
                        var f = h(e._raw);
                        f && "SUCCESS" == f.state && f.path ? (WO.updateMsg({
                            timeout: 3e3,
                            content: "文档上传成功!"
                        }),
                        WO.fire("openuploadeddoc", f.path, "blank", f)) : WO.updateMsg({
                            timeout: 3e3,
                            content: "文档转换出错!"
                        }),
                        a.off("uploadSuccess", c),
                        a.off("uploadError error", d)
                    }
                      , d = function() {
                        $(document.body).removeClass("loading"),
                        WO.updateMsg({
                            timeout: 3e3,
                            content: "文档转换出错!"
                        }),
                        a.off("uploadSuccess", c),
                        a.off("uploadError error", d)
                    }
                    ;
                    a.on("uploadSuccess", c),
                    a.on("uploadError error", d)
                },
                getUploadedDoc: function(a, b) {
                    WO.showMsg({
                        keepshow: !0,
                        content: "正在获取上传文档..."
                    }),
                    WO.addMask(),
                    $.get(g, {
                        cmd: "openuploadeddoc",
                        fid: a.fid
                    }, function(a) {
                        WO.removeMask();
                        var c = h(a)
                          , d = c.bdjson;
                        c.html ? (i(c.fid, c.path),
                        WO.hideMsg(),
                        b && b(c.html, "html"),
                        j(c.path)) : d && d["document.xml"] && d["document.xml"].length ? (i(c.fid, c.path),
                        WO.hideMsg(),
                        b && b(d["document.xml"], "bdjson"),
                        j(c.filename)) : (WO.updateMsg({
                            timeout: 3e3,
                            content: "文档获取失败!"
                        }),
                        b && b())
                    })
                },
                download: function() {
                    var a, b = (+new Date).toString(36), c = d || "未命名文档", e = WO.editor.getContent(), f = $("<iframe>").attr("name", "iframe_" + b).attr("id", "iframe_" + b).hide().appendTo(document.body).on("load", function() {
                        setTimeout(function() {
                            f.remove(),
                            a.remove()
                        }, 500)
                    });
                    c = c.substr(c.lastIndexOf("/") + 1),
                    c = c.substr(0, c.lastIndexOf(".")) || c,
                    a = $('<form action="' + g + '?cmd=downloaddoc" method="post" target="iframe_' + b + '" accept-charset="utf-8">' + '<input type="hidden" name="content" value="" />' + '<input type="hidden" name="filename" value="" />' + '<input type="submit" name="content" value="" />' + "</form>").attr("name", "iframe_" + b).attr("id", "iframe_" + b).hide().appendTo(document.body),
                    a.find("[name=content]").val(e),
                    a.find("[name=filename]").val(c),
                    f.on("load", function() {
                        var d, a = f[0], b = a.contentDocument || a.contentWindow.document, c = b.body.innerText;
                        c ? (d = h(c),
                        "SUCCESS" == d.state ? console && console.log("SUCCESS") : console && console.log(d.state)) : console && console.log("empty text")
                    }),
                    a.submit()
                },
                current: i
            }
        }),
        $.extend(WO, {
            share: {
                list: function(a) {
                    $.get(g, {
                        cmd: "listmyshare"
                    }, function(b) {
                        var c = h(b);
                        c && "SUCCESS" == c.state ? a && a(c.list) : a && a(null )
                    })
                },
                add: function(a, b) {
                    $.post(g + "?cmd=" + "addshare" + "&fid=" + e + "&path=" + d, {
                        content: a.content
                    }, function(a) {
                        var c = h(a);
                        c && "SUCCESS" == c.state ? (!d && c.fid && i(c.fid, c.path),
                        b && b(c.share)) : b && b(null )
                    })
                },
                rm: function(a, b) {
                    $.get(g, {
                        cmd: "rmshare",
                        id: a.id
                    }, function(a) {
                        var c = h(a);
                        c && "SUCCESS" == c.state ? b && b(c) : b && b(null )
                    })
                }
            }
        })
    }(),
    function() {
        var a = []
          , b = {}
          , c = !1;
        $.extend(WO, {
            registerUI: function(b, c, d) {
                "function" == typeof c && (d = c,
                c = null ),
                a.push({
                    id: b,
                    ui: d,
                    deps: c
                })
            },
            initUI: function() {
                c || $.each(a, function(a, c) {
                    var d = c.deps;
                    d && (d = $.map(d, function(a) {
                        return WO.getUI(a)
                    })),
                    b[c.id] = c.ui.apply(null , [b].concat(d || []))
                })
            },
            getUI: function(a) {
                return b[a]
            }
        })
    }(),
    function() {
        WO.initLogin = function() {
            function b(a) {
                var b = a && a.id;
                b && setTimeout(function() {
                    fio.user.fire("login"),
                    $(".login-required").removeClass("login-required").addClass("login-done")
                }, 100),
                $(".userlogout").click(function() {
                    fio.user.logout().then(function() {
                        $(".username").hide(),
                        $(".useravatar").hide(),
                        $(".userlogout").hide(),
                        $(".userlogin").show(),
                        window.location.href = "welcome.html"
                    })
                })[b ? "show" : "hide"](),
                $(".userlogin").click(function() {
                    fio.user.login({
                        remember: 2592e3
                    })
                })[b ? "hide" : "show"](),
                $(document).delegate(".login-button", "click", function() {
                    fio.user.login({
                        remember: 2592e3
                    })
                }),
                b && ($(".username").text(a.username).show(),
                $(".useravatar").css("background-image", "url(" + a.smallImage + ")").show())
            }
            b(fio.user.current())
        }
        ,
        WO.doAfterLogin = function(a) {
            var b = fio.user.current();
            b && b.access_token ? setTimeout(function() {
                a(b)
            }) : fio.user.on("login", function(b, c) {
                console.log(b, c),
                a(b)
            })
        }
    }(),
    WO.registerUI("eve", function() {
        return {
            setup: function(a) {
                var b = {};
                return a.on = function(a, c) {
                    var d = $.isArray(a) ? a : a.split(" ");
                    return $.each(d, function(a, d) {
                        var e = b[d] || (b[d] = []);
                        e.push(c)
                    }),
                    this
                }
                ,
                a.off = function(a, c) {
                    var e, d = b[a];
                    return d && (e = d.indexOf(c),
                    ~e ? d.splice(e, 1) : c[a] = null ),
                    this
                }
                ,
                a.once = function(b, c) {
                    return this.on(b, function d() {
                        c.apply(a, arguments),
                        a.off(b, d)
                    })
                }
                ,
                a.fire = function(c) {
                    var d = b[c]
                      , e = [].slice.call(arguments, 1);
                    return d && $.each(d, function(b, c) {
                        return 1 == c.apply(a, e) ? !1 : void 0
                    }),
                    this
                }
                ,
                a
            }
        }
    }),
    WO.registerUI("wox", function() {
        var b = WO.getUI("eve");
        b.setup(WO)
    }),
    WO.registerUI("fiox", function() {
        var b = WO.getUI("eve");
        b.setup(fio.user)
    }),
    function() {
        $.ajaxSetup({
            cache: !1
        })
    }(),
    WO.registerUI("keymap", function() {
        var d, b = {
            "ctrl+alt+192": "newdoc",
            "ctrl+78": "openmenu",
            "ctrl+79": "openmenu",
            "ctrl+83": "savedoc",
            "ctrl+shift+83": "saveasdoc",
            "ctrl+alt+83": "sharedoc",
            "ctrl+80": "print",
            27: "esc",
            "ctrl+70": "search",
            "ctrl+65": "selectall",
            "ctrl+187": "upsize",
            "ctrl+189": "downsize",
            8: "backspace"
        }, c = function(a, c) {
            "string" != typeof a && (c = a);
            var e, f, d = c.keyCode;
            if (91 != d)
                for (f in b)
                    e = f.match(/(ctrl\+)?(shift\+)?(alt\+)?([\d]+)/),
                    !(c.ctrlKey || c.metaKey) ^ Boolean(e[1]) && !c.shiftKey ^ Boolean(e[2]) && !c.altKey ^ Boolean(e[3]) && d == e[4] && WO.fire(b[f], b[f], c)
        }
        ;
        WO.on("backspace", function(a, b) {
            var c = b.target || b.srcElement;
            c == document.body && b && (b.preventDefault ? b.preventDefault() : b.returnValue = !1)
        }),
        d = WO.editor,
        d && (d.on("keydown", c),
        $(document.body).on("keydown", c),
        UE.browser.chrome && d.on("keydown", function(a, b) {
            var c = b.keyCode || b.which;
            return (b.metaKey && b.altKey || b.ctrlKey && b.shiftKey) && 73 == c ? !0 : void 0
        }),
        WO.on("selectall", function(a, b) {
            var c = b.target || b.srcElement;
            c && c.tagName && "input" != c.tagName.toLowerCase() && "textarea" != c.tagName.toLowerCase() && 1 != c.contentEditable && (b && (b.preventDefault ? b.preventDefault() : b.returnValue = !1),
            WO.editor.execCommand("selectAll"))
        }),
        WO.on("upsize", function(a, b) {
            b && (b.preventDefault ? b.preventDefault() : b.returnValue = !1),
            WO.editor.execCommand("upsize")
        }),
        WO.on("downsize", function(a, b) {
            b && (b.preventDefault ? b.preventDefault() : b.returnValue = !1),
            WO.editor.execCommand("downsize")
        }))
    }),
    WO.registerUI("enter", function() {
        function b(a, b) {
            var c = (b || location.hash).match(new RegExp("(^|&|#|\\?)" + a + "=([^&]+)"));
            return c && c[2]
        }
        WO.ready(function() {
            var a, d;
            (a = b("tpl")) ? WO.fire("loadtemplate", a) : (d = b("path")) ? WO.fire("opendoc", d, "current") : (action = b("action")) && WO.fire("switchtotpl"),
            WO.fire("afterloadhash")
        })
    }),
    WO.registerUI("confirm", function() {
        function d() {
            function c(b, c) {
                switch ("string" != typeof b && (c = b),
                c.keyCode) {
                case 13:
                    a.trigger("ok"),
                    a.close();
                    break;
                case 27:
                    a.close()
                }
            }
            if (!WO._confirmDialog) {
                var a = new FUI.Dialog({
                    title: "",
                    className: "wo-dialog wo-confirm",
                    mask: {
                        className: "wo-confirm-mask",
                        opacity: .2
                    }
                });
                a.on("ok", function() {
                    b && b()
                }),
                a.on("open", function() {
                    $(document).on("keydown", c),
                    WO.editor.on("keydown", c)
                }),
                a.on("close", function() {
                    $(document).off("keydown", c),
                    WO.editor.off("keydown", c)
                }),
                $(a.getContentElement()).append('<div class="wo-confirm-message"></div>'),
                a.positionTo(document.body),
                WO._confirmDialog = a
            }
            return WO._confirmDialog
        }
        var b = function() {}
          , c = function() {}
        ;
        WO.on("confirm", function(a) {
            var g, e = d(), f = $(e.getElement());
            a && (a.onOk && (b = a.onOk),
            a.onCancel && (c = a.onCancel),
            f.find(".fui-dialog-caption").html(a.title || ""),
            f.find(".wo-confirm-message").html(a.message || "确定?"),
            g = e.getButtons(),
            g && g.length && (g[0].setLabel(a.textOk || "确定"),
            g[1].setLabel(a.textCancel || "取消"),
            !a.textOk && $(g[0].getElement()).hide(),
            !a.textCancel && $(g[1].getElement()).hide())),
            e.open()
        })
    }),
    WO.registerUI("searchonwenku", function() {
        var b;
        WO.on("searchonwenku", function(a) {
            function c() {
                UE.browser.webkit ? b.transition({
                    x: "-246px"
                }, 300, "in-out") : b.animate({
                    "margin-left": "-246px"
                }, "linear")
            }
            function d() {
                UE.browser.webkit ? b.transition({
                    x: "246px"
                }, 300, "in-out") : b.animate({
                    "margin-left": "0"
                }, "linear")
            }
            b || (b = $('<div class="search-wenku">   到文库搜索：<a class="keywords" target="_blank" href=""></a>   <div class="s-close" id="s-close">x</div></div>'),
            b.appendTo(document.body)),
            b.find(".keywords").text(a).attr("href", "http://wenku.baidu.com/search?from=wordonline&ie=utf-8&word=" + encodeURI(a)),
            c(),
            setTimeout(function() {
                d()
            }, 12e3),
            $("#s-close").on("click", function() {
                d()
            })
        })
    }),
    WO.addMask = function() {
        $(document.body).addClass("loading"),
        setTimeout(function() {
            WO.editor.blur()
        })
    }
    ,
    WO.removeMask = function() {
        $(document.body).removeClass("loading")
    }
    ,
    WO.registerUI("beforeunload", function() {
        WO.on("afterloadhash", function() {
            var a = WO.editor;
            setTimeout(function() {
                a.on("contentchange", function() {
                    window.onbeforeunload = function() {
                        return "文档未保存，确定离开页面？"
                    }
                })
            }, 200),
            WO.on("doccurrentchange", function() {
                WO.isUnSave || (window.onbeforeunload = function() {}
                )
            })
        })
    }),
    UE.plugin.register("cut", function() {
        var a = this;
        return {
            commands: {
                cut: {
                    execCommand: function() {
                        a.document.execCommand("cut") || alert("浏览器不支持,请使用 'Ctrl + x'")
                    }
                }
            }
        }
    }),
    UE.plugin.register("fontsizechange", function() {
        var a = this
          , b = [8, 9, 10, 11, 12, 14, 16, 18, 20, 24, 26, 36, 48, 72];
        return {
            shortcutkey: {
                upsize: 'ctrl+187"',
                downsize: "ctrl+189"
            },
            commands: {
                upsize: {
                    execCommand: function() {
                        var d, c = parseInt(a.queryCommandValue("fontsize"));
                        for (d = 0; d < b.length; d++)
                            if (b[d] > c) {
                                a.execCommand("fontsize", b[d] + "px");
                                break
                            }
                    }
                },
                downsize: {
                    execCommand: function() {
                        var d, c = parseInt(a.queryCommandValue("fontsize"));
                        for (d = b.length - 1; d >= 0; d--)
                            if (b[d] < c) {
                                a.execCommand("fontsize", b[d] + "px");
                                break
                            }
                    }
                }
            }
        }
    }),
    UE.plugin.register("justify", function() {
        var a = this;
        return {
            commands: {
                justifyleft: {
                    execCommand: function() {
                        a.execCommand("justify", "left")
                    },
                    queryCommandState: function() {
                        return -1 == a.queryCommandState("justify") ? -1 : "left" == a.queryCommandValue("justify") ? 1 : 0
                    }
                },
                justifycenter: {
                    execCommand: function() {
                        a.execCommand("justify", "center")
                    },
                    queryCommandState: function() {
                        return -1 == a.queryCommandState("justify") ? -1 : "center" == a.queryCommandValue("justify") ? 1 : 0
                    }
                },
                justifyright: {
                    execCommand: function() {
                        a.execCommand("justify", "right")
                    },
                    queryCommandState: function() {
                        return -1 == a.queryCommandState("justify") ? -1 : "right" == a.queryCommandValue("justify") ? 1 : 0
                    }
                },
                justifyjustify: {
                    execCommand: function() {
                        a.execCommand("justify", "justify")
                    },
                    queryCommandState: function() {
                        return -1 == a.queryCommandState("justify") ? -1 : "justify" == a.queryCommandValue("justify") ? 1 : 0
                    }
                }
            }
        }
    }),
    UE.plugin.register("rowspacing", function() {
        var a = this;
        return {
            commands: {
                rowspacingtop: {
                    execCommand: function(b, c) {
                        a.execCommand("rowspacing", c, "top")
                    },
                    queryCommandState: function() {
                        return -1 == a.queryCommandState("justify") ? -1 : "left" == a.queryCommandValue("justify") ? 1 : 0
                    }
                },
                rowspacingbottom: {
                    execCommand: function(b, c) {
                        a.execCommand("rowspacing", c, "bottom")
                    },
                    queryCommandState: function() {
                        return -1 == a.queryCommandState("justify") ? -1 : "left" == a.queryCommandValue("justify") ? 1 : 0
                    }
                }
            }
        }
    }),
    UE.plugin.register("fontstyle", function() {
        var a = this;
        return {
            commands: {
                fontstyle: {
                    execCommand: function(b, c) {
                        a.execCommand("paragraph", c.tagName, {
                            style: c.style
                        })
                    }
                }
            }
        }
    }),
    UE.Editor.prototype._bkGetActionUrl = UE.Editor.prototype.getActionUrl,
    UE.Editor.prototype.getActionUrl = function(a) {
        return "uploadimage" == a || "uploadimage" == a ? WO.WO_SERVER_URL + "controller.php?cmd=addimage" : "uploadscrawl" == a ? WO.WO_SERVER_URL + "controller.php?cmd=addscrawl" : this._bkGetActionUrl.call(this, a)
    }
    ,
    UE.plugin.register("export", function() {
        return {
            commands: {
                exporttxt: {
                    execCommand: function() {},
                    queryCommandState: function() {
                        return -1
                    }
                },
                exportword: {
                    execCommand: function() {},
                    queryCommandState: function() {
                        return -1
                    }
                },
                exportpdf: {
                    execCommand: function() {},
                    queryCommandState: function() {
                        return -1
                    }
                }
            }
        }
    }),
    UE.plugin.register("todo", function() {
        return {
            commands: function(a) {
                var b, c;
                for (a = a.split(" "),
                b = {},
                c = 0; c < a.length; c++)
                    b[a[c]] = {
                        execCommand: function() {},
                        queryCommandState: function() {
                            return -1
                        }
                    };
                return b
            }("formula comment showcomment coordination")
        }
    }),
    UE.plugin.register("messagefix", function() {
        var a = this;
        a.on("showmessage", function() {
            var b = $(a.container);
            $(".edui-editor-messageholder").css({
                position: "absolute",
                top: b.offset().top + 4,
                left: b.offset().left + b.width() - 150 - 3,
                width: "150px",
                height: "auto"
            }).appendTo(document.body)
        })
    }),
    UE.plugin.register("autoupload", function() {
        function a(a, b) {
            var i, k, n, o, p, q, r, c = b, l = /image\/\w+/i.test(a.type) ? "image" : "file", m = "loading_" + (+new Date).toString(36), d = c.getOpt(l + "FieldName"), e = c.getOpt(l + "UrlPrefix"), f = c.getOpt(l + "MaxSize"), g = c.getOpt(l + "AllowFiles"), h = c.getActionUrl(c.getOpt(l + "ActionName")), j = function(a) {
                var b = c.document.getElementById(m);
                b && UE.dom.domUtils.remove(b),
                c.fireEvent("showmessage", {
                    id: m,
                    content: a,
                    type: "error",
                    timeout: 4e3
                })
            }
            ;
            return "image" == l ? (i = '<img class="loadingclass" id="' + m + '" src="' + c.options.themePath + c.options.theme + '/images/spacer.gif">',
            k = function(a) {
                var b = e + a.url
                  , d = c.document.getElementById(m);
                d && (UE.dom.domUtils.removeClasses(d, "loadingclass"),
                d.setAttribute("src", b),
                d.setAttribute("_src", b),
                d.setAttribute("alt", a.original || ""),
                d.removeAttribute("id"),
                c.trigger("contentchange", d))
            }
            ) : (i = '<p><img class="loadingclass" id="' + m + '" src="' + c.options.themePath + c.options.theme + '/images/spacer.gif">' + "</p>",
            k = function(a) {
                var b = e + a.url
                  , d = c.document.getElementById(m)
                  , f = c.selection.getRange()
                  , g = f.createBookmark();
                f.selectNode(d).select(),
                c.execCommand("insertfile", {
                    url: b
                }),
                f.moveToBookmark(g).select()
            }
            ),
            c.execCommand("inserthtml", i),
            c.getOpt(l + "ActionName") ? a.size > f ? (j(c.getLang("autoupload.exceedSizeError")),
            void 0) : (n = a.name ? a.name.substr(a.name.lastIndexOf(".")) : "",
            n && "image" != l || g && -1 == (g.join("") + ".").indexOf(n.toLowerCase() + ".") ? (j(c.getLang("autoupload.exceedTypeError")),
            void 0) : (o = new XMLHttpRequest,
            p = new FormData,
            q = UE.utils.serializeParam(c.queryCommandValue("serverparam")) || "",
            r = UE.utils.formatUrl(h + (-1 == h.indexOf("?") ? "?" : "&") + q),
            p.append(d, a, a.name || "blob." + a.type.substr("image/".length)),
            p.append("type", "ajax"),
            o.open("post", r, !0),
            o.setRequestHeader("X-Requested-With", "XMLHttpRequest"),
            o.addEventListener("load", function(a) {
                try {
                    var b = new Function("return " + UE.utils.trim(a.target.response))();
                    "SUCCESS" == b.state && b.url ? (k(b),
                    c.fireEvent("imageUploadSuccess", b)) : j(b.state)
                } catch (d) {
                    j(c.getLang("autoupload.loadError"))
                }
            }),
            o.send(p),
            void 0)) : (j(c.getLang("autoupload.errorLoadConfig")),
            void 0)
        }
        function b(a) {
            return a.clipboardData && a.clipboardData.items && 1 == a.clipboardData.items.length && /^image\//.test(a.clipboardData.items[0].type) ? a.clipboardData.items : null
        }
        function c(a) {
            return a.dataTransfer && a.dataTransfer.files ? a.dataTransfer.files : null
        }
        return {
            outputRule: function(a) {
                UE.utils.each(a.getNodesByTagName("img"), function(a) {
                    /\b(loaderrorclass)|(bloaderrorclass)\b/.test(a.getAttr("class")) && a.parentNode.removeChild(a)
                }),
                UE.utils.each(a.getNodesByTagName("p"), function(a) {
                    /\bloadpara\b/.test(a.getAttr("class")) && a.parentNode.removeChild(a)
                })
            },
            bindEvents: {
                defaultOptions: {
                    enableDragUpload: !0,
                    enablePasteUpload: !0
                },
                ready: function() {
                    var f, e = this;
                    window.FormData && window.FileReader && (f = function(d) {
                        var i, h, f = !1, g = "paste" == d.type ? b(d) : c(d);
                        if (g) {
                            for (h = g.length; h--; )
                                i = g[h],
                                i.getAsFile && (i = i.getAsFile()),
                                i && i.size > 0 && (a(i, e),
                                f = !0);
                            f && d.preventDefault()
                        }
                    }
                    ,
                    e.getOpt("enablePasteUpload") !== !1 && UE.dom.domUtils.on(e.body, "paste ", f),
                    e.getOpt("enableDragUpload") !== !1 ? (UE.dom.domUtils.on(e.body, "drop", f),
                    UE.dom.domUtils.on(e.body, "dragover", function(a) {
                        "Files" == a.dataTransfer.types[0] && a.preventDefault()
                    })) : UE.browser.gecko && UE.dom.domUtils.on(e.body, "drop", function(a) {
                        c(a) && a.preventDefault()
                    }),
                    UE.utils.cssRule("loading", ".loadingclass{display:inline-block;cursor:default;background: url('" + this.options.themePath + this.options.theme + "/images/loading.gif') no-repeat center center transparent;border:1px solid #cccccc;margin-left:1px;height: 22px;width: 22px;}\n" + ".loaderrorclass{display:inline-block;cursor:default;background: url('" + this.options.themePath + this.options.theme + "/images/loaderror.png') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;" + "}", this.document))
                }
            }
        }
    }),
    UE.plugin.register("simpleupload", function() {
        function d() {
            var d = c.offsetWidth || 46
              , e = c.offsetHeight || 24
              , f = document.createElement("iframe")
              , g = "display:block;width:" + d + "px;height:" + e + "px;overflow:hidden;border:0;margin:0;padding:0;position:absolute;top:0;left:0;filter:alpha(opacity=0);-moz-opacity:0;-khtml-opacity: 0;opacity: 0;cursor:pointer;";
            UE.dom.domUtils.on(f, "load", function() {
                var k, l, m, n, c = (+new Date).toString(36), i = f.contentDocument || f.contentWindow.document, j = i.body, h = i.createElement("div");
                h.innerHTML = '<form id="edui_form_' + c + '" target="edui_iframe_' + c + '" method="POST" enctype="multipart/form-data" action="' + a.getOpt("serverUrl") + '" ' + 'style="' + g + '">' + '<input id="edui_input_' + c + '" type="file" accept="image/*" name="' + a.options.imageFieldName + '" ' + 'style="' + g + '">' + "</form>" + '<iframe id="edui_iframe_' + c + '" name="edui_iframe_' + c + '" style="display:none;width:0;height:0;border:0;margin:0;padding:0;position:absolute;"></iframe>',
                h.className = "edui-" + a.options.theme,
                h.id = a.ui.id + "_iframeupload",
                j.style.cssText = g,
                j.style.width = d + "px",
                j.style.height = e + "px",
                j.appendChild(h),
                j.parentNode && (j.parentNode.style.width = d + "px",
                j.parentNode.style.height = d + "px"),
                k = i.getElementById("edui_form_" + c),
                l = i.getElementById("edui_input_" + c),
                m = i.getElementById("edui_iframe_" + c),
                UE.dom.domUtils.on(l, "change", function() {
                    function f() {
                        try {
                            var c, d, e, h = (m.contentDocument || m.contentWindow.document).body, i = h.innerText || h.textContent || "";
                            d = new Function("return " + i)(),
                            c = a.options.imageUrlPrefix + d.url,
                            "SUCCESS" == d.state && d.url ? (e = a.document.getElementById(b),
                            UE.dom.domUtils.removeClasses(e, "loadingclass"),
                            e.setAttribute("src", c),
                            e.setAttribute("_src", c),
                            e.setAttribute("alt", d.original || ""),
                            e.removeAttribute("id"),
                            a.fireEvent("imageUploadSuccess", d)) : g && g(d.state)
                        } catch (j) {
                            g && g(a.getLang("simpleupload.loadError"))
                        }
                        k.reset(),
                        UE.dom.domUtils.un(m, "load", f)
                    }
                    function g(c) {
                        if (b) {
                            var d = a.document.getElementById(b);
                            d && UE.dom.domUtils.remove(d),
                            a.fireEvent("showmessage", {
                                id: b,
                                content: c,
                                type: "error",
                                timeout: 4e3
                            })
                        }
                    }
                    var b, c, d, e, h, i;
                    if (l.value) {
                        if (b = "loading_" + (+new Date).toString(36),
                        c = UE.utils.serializeParam(a.queryCommandValue("serverparam")) || "",
                        d = a.getActionUrl(a.getOpt("imageActionName")),
                        e = a.getOpt("imageAllowFiles"),
                        a.focus(),
                        a.execCommand("inserthtml", '<img class="loadingclass" id="' + b + '" src="' + a.options.themePath + a.options.theme + '/images/spacer.gif">'),
                        !a.getOpt("imageActionName"))
                            return errorHandler(a.getLang("autoupload.errorLoadConfig")),
                            void 0;
                        if (h = l.value,
                        i = h ? h.substr(h.lastIndexOf(".")) : "",
                        !i || e && -1 == (e.join("") + ".").indexOf(i.toLowerCase() + "."))
                            return g(a.getLang("simpleupload.exceedTypeError")),
                            void 0;
                        UE.dom.domUtils.on(m, "load", f),
                        k.action = UE.utils.formatUrl(d + (-1 == d.indexOf("?") ? "?" : "&") + c),
                        k.submit()
                    }
                }),
                a.addListener("selectionchange", function() {
                    clearTimeout(n),
                    n = setTimeout(function() {
                        var b = a.queryCommandState("simpleupload");
                        l.disabled = -1 == b ? "disabled" : !1
                    }, 400)
                }),
                b = !0
            }),
            f.style.cssText = g,
            c.appendChild(f)
        }
        var c, a = this, b = !1;
        return {
            bindEvents: {
                ready: function() {
                    UE.utils.cssRule("loading", ".loadingclass{display:inline-block;cursor:default;background: url('" + this.options.themePath + this.options.theme + "/images/loading.gif') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;}\n" + ".loaderrorclass{display:inline-block;cursor:default;background: url('" + this.options.themePath + this.options.theme + "/images/loaderror.png') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;" + "}", this.document)
                },
                simpleuploadbtnready: function(b, e) {
                    c = e,
                    a.afterConfigReady(d)
                }
            },
            outputRule: function(a) {
                UE.utils.each(a.getNodesByTagName("img"), function(a) {
                    /\b(loaderrorclass)|(bloaderrorclass)\b/.test(a.getAttr("class")) && a.parentNode.removeChild(a)
                })
            },
            commands: {
                simpleupload: {
                    queryCommandState: function() {
                        return b ? 0 : -1
                    }
                }
            }
        }
    }),
    UE.commands["preview"] = {
        execCommand: function() {
            function b() {
                var a = new Date
                  , b = function(a) {
                    return N = ["00", "01", "02", "03", "04", "05", "06", "07", "08", "09"][a] || a
                }
                ;
                return b(a.getMonth() + 1) + "-" + b(a.getDate()) + " " + b(a.getHours()) + ":" + b(a.getMinutes())
            }
            var a = WO.doc.current().path;
            WO.utils.openPostWin(WO.WO_ROOT_URL + "preview.php", {
                content: this.getContent(),
                title: a ? a.substring(a.lastIndexOf("/") + 1, a.lastIndexOf(".")) : "未命名文档",
                createTime: b(),
                author: fio.user.current().username
            })
        },
        notNeedUndo: 1
    },
    UE.plugins["autoheight"] = function() {
        function g() {
            var a = this;
            clearTimeout(f),
            h || (!a.queryCommandState || a.queryCommandState && 1 != a.queryCommandState("source")) && (f = setTimeout(function() {
                for (var b = a.body.lastChild; b && 1 != b.nodeType; )
                    b = b.previousSibling;
                b && 1 == b.nodeType && (b.style.clear = "both",
                e = Math.max(UE.dom.domUtils.getXY(b).y + b.offsetHeight + 225, Math.max(d.minFrameHeight, d.initialFrameHeight)),
                e != c && (e !== parseInt(a.iframe.parentNode.style.height) && (a.iframe.parentNode.style.height = e + "px"),
                a.body.style.height = e + "px",
                c = e),
                UE.dom.domUtils.removeStyle(b, "clear"))
            }, 50))
        }
        var b, e, f, c, d, h, a = this;
        a.autoHeightEnabled = a.options.autoHeightEnabled !== !1,
        a.autoHeightEnabled && (c = 0,
        d = a.options,
        a.addListener("fullscreenchanged", function(a, b) {
            h = b
        }),
        a.addListener("destroy", function() {
            a.removeListener("contentchange afterinserthtml keyup mouseup", g)
        }),
        a.enableAutoHeight = function() {
            var c, a = this;
            a.autoHeightEnabled && (c = a.document,
            a.autoHeightEnabled = !0,
            b = c.body.style.overflowY,
            c.body.style.overflowY = "hidden",
            a.addListener("contentchange afterinserthtml keyup mouseup", g),
            setTimeout(function() {
                g.call(a)
            }, UE.browser.gecko ? 100 : 0),
            a.fireEvent("autoheightchanged", a.autoHeightEnabled))
        }
        ,
        a.disableAutoHeight = function() {
            a.body.style.overflowY = b || "",
            a.removeListener("contentchange", g),
            a.removeListener("keyup", g),
            a.removeListener("mouseup", g),
            a.autoHeightEnabled = !1,
            a.fireEvent("autoheightchanged", a.autoHeightEnabled)
        }
        ,
        a.on("setHeight", function() {
            a.disableAutoHeight()
        }),
        a.addListener("ready", function() {
            var b, c;
            a.enableAutoHeight(),
            UE.dom.domUtils.on(UE.browser.ie ? a.body : a.document, UE.browser.webkit ? "dragover" : "drop", function() {
                clearTimeout(b),
                b = setTimeout(function() {
                    g.call(a)
                }, 100)
            }),
            window.onscroll = function() {
                null === c ? c = this.scrollY : 0 == this.scrollY && 0 != c && (a.window.scrollTo(0, 0),
                c = null )
            }
        }))
    }
    ,
    UE.plugin.register("blockindent", function() {
        var a = this
          , b = function() {
            var c = UE.dom.domUtils.filterNodeList(a.selection.getStartElementPath(), "p h1 h2 h3 h4 h5 h6");
            return c && c.style.marginLeft && Math.round(parseInt(c.style.marginLeft) / 32)
        }
        ;
        return {
            commands: {
                blockindent: {
                    execCommand: function() {
                        var b = a.queryCommandValue("blockindent");
                        a.execCommand("paragraph", "p", {
                            style: "margin-left:" + (32 * ++b + "px")
                        })
                    },
                    queryCommandValue: b
                },
                blockoutdent: {
                    execCommand: function() {
                        var b = a.queryCommandValue("blockoutdent");
                        b > 0 && a.execCommand("paragraph", "p", {
                            style: "margin-left:" + (32 * --b + "px")
                        })
                    },
                    queryCommandValue: b
                }
            }
        }
    }),
    UE.plugin.register("share", function() {
        return {
            commands: {
                share: {
                    execCommand: function(a) {
                        WO.fire("sharedoc", a)
                    }
                }
            }
        }
    }),
    UE.plugin.register("directory", function() {
        var a = this;
        return {
            commands: {
                directory: {
                    execCommand: function() {
                        a.fireEvent("toggledirectory")
                    }
                }
            }
        }
    }),
    WO.registerUI("topbar/logo", function() {
        var a = window.DEBUG ? "./src.php" : "./"
          , b = $('<div class="left">   <a class="guide logo-doc logo" href="' + a + '">百度Doc</a>' + '   <a class="guide logo-wenku beta" href="http://wenku.baidu.com" target="_blank">百度文库</a>' + "</div>").appendTo("#header")
          , c = b.find(".logo-wenku");
        $(window).on("resize", function() {
            var a = $(window).width();
            a >= 600 ? c.show() : c.hide()
        }),
        $(window).width() < 600 && c.hide()
    }),
    WO.registerUI("topbar/moreservice", function() {
        function d() {
            b.css("margin-left", "-46px").hide().prependTo("#header .left").moreService({
                button: {
                    "float": "left",
                    width: "45px",
                    height: "45px",
                    "border-right": "1px solid rgba(255, 255, 255, .5)"
                }
            }).fadeIn("slow").animate({
                "margin-left": 0
            }, 100, "linear")
        }
        var b, c = $("<link>").attr("href", "http://baiduoffice.duapp.com/public/assets/style/moreService.css").attr("rel", "stylesheet");
        $("head").append(c),
        $.getScript("http://baiduoffice.duapp.com/public/widget/moreService.js", d),
        b = $('<div class="wo-moreservice" id="moreservice"></div>')
    }),
    WO.registerUI("topbar/user", function() {
        function k(a) {
            if (a)
                h.setLabel(a.username),
                h.getIconWidget().setImage(a.smallImage),
                h.show(),
                g.hide(),
                fio.user.fire("login", a);
            else {
                if (-1 == window.location.href.indexOf("nocheck"))
                    return m();
                g.show()
            }
            f.hide(),
            d = a
        }
        function l() {
            fio.user.logout(),
            g.show(),
            h.hide(),
            fio.user.fire("logout"),
            window.location.href = "./welcome.html"
        }
        function m() {
            g.setLabel(WO.getLang("ui.loggingin")),
            fio.user.login({
                redirectUrl: WO.WO_ROOT_URL + (window.DEBUG ? "src.php" : ""),
                remember: 604800
            })
        }
        function n() {
            fio.user.login({
                redirectUrl: WO.WO_ROOT_URL + (window.DEBUG ? "src.php" : ""),
                remember: 604800,
                force: !0
            }).then(k)
        }
        function o(a) {
            var b = $('<p class="login-tip"></p>').html(WO.getLang("ui.requirelogin"));
            a.append(b),
            WO.doAfterLogin(function() {
                a.removeClass("login-required")
            }),
            fio.user.on("logout", function() {
                a.addClass("login-required")
            })
        }
        var d, e, f, g, h, i, j;
        return WO.getUI("eve"),
        WO.editor,
        e = $('<div class="user-panel right"></div>').appendTo("#header"),
        f = $('<span class="loading-tip"></span>').text(WO.getLang("ui.checklogin")).appendTo(e),
        g = new FUI.Button({
            label: WO.getLang("ui.login"),
            text: WO.getLang("ui.login"),
            className: "login-button"
        }).appendTo(e[0]).hide(),
        h = new FUI.Button({
            icon: {
                img: "data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs="
            },
            className: "user-button"
        }).appendTo(e[0]).hide(),
        i = new FUI.PopupMenu({
            className: "user-menu"
        }).appendTo(document.getElementById("content-wrapper")).positionTo(h),
        j = i.getMenuWidget().show(),
        $.each(["userinfo", "fui-spliter", "switchuser", "logout"], function(a, b) {
            j.appendItem(new FUI.Item({
                label: WO.getLang("ui." + b),
                className: b,
                value: b
            }))
        }),
        h.on("click", function() {
            var a, b;
            i.open(),
            a = $(i.getElement()),
            b = $(h.getElement()),
            a.offset({
                left: b.offset().left - a.outerWidth() + b.outerWidth() - 10,
                top: b.offset().top + b.outerHeight()
            })
        }),
        j.on("select", function(a, b) {
            switch (b.value) {
            case "userinfo":
                window.open("http://i.baidu.com");
                break;
            case "gotonetdisk":
                window.open("http://pan.baidu.com/disk/home#path=/apps/wordonline");
                break;
            case "switchuser":
                n();
                break;
            case "logout":
                l()
            }
            j.clearSelect(),
            i.hide()
        }),
        WO.ready(function() {
            fio.user.check().then(k)["catch"](function() {
                g.show(),
                h.hide(),
                f.hide()
            })
        }),
        g.on("click", m),
        $("#content-wrapper").delegate(".login-button", "click", m),
        {
            getCurrent: function() {
                return d
            },
            loginLink: function() {
                return $("<a></a>").click(m)
            },
            requireLogin: o
        }
    }),
    WO.registerUI("topbar/title", function() {
        $('<h1 class="center" id="wordonline-filename"></a></h1>').appendTo("#header")
    }),
    WO.registerUI("topbar/fastvisit", function() {
        function f(a, d, e) {
            var f = WO.getLang("ui.quickvisit." + a)
              , g = new FUI.Button({
                className: "wo-fastvisit-btn wo-" + a,
                label: f,
                text: f,
                layout: "bottom"
            })
              , h = g.getElement();
            return ("right" == d ? c : b)[e ? "prepend" : "append"](h),
            g
        }
        var b = $(".header .left")
          , c = $(".header .right")
          , d = {};
        return $(".wo-fastvisit-btn"),
        d.add = f,
        d
    }),
    WO.registerUI("topbar/fastvisit/feedback", function() {
        var b = WO.getUI("topbar/fastvisit")
          , c = b.add("feedback", "right", !0);
        c.on("click", function() {
            WO.utils.openGetWin("http://tieba.baidu.com/f?kw=%E7%99%BE%E5%BA%A6doc")
        })
    }),
    WO.registerUI("topbar/fastvisit/download", function() {
        var b = WO.getUI("topbar/fastvisit")
          , c = b.add("share", "right", !0);
        c.on("click", function() {
            WO.fire("sharedoc")
        })
    }),
    WO.registerUI("topbar/fastvisit/new", function() {
        var b = WO.getUI("topbar/fastvisit")
          , c = b.add("new", "right", !0);
        c.on("click", function() {
            WO.utils.openGetWin(window.DEBUG ? "./src.php" : "./")
        })
    }),
    WO.registerUI("topbar/fastvisit/download", function() {
        var b = WO.getUI("topbar/fastvisit")
          , c = b.add("download", "right", !0);
        c.on("click", function() {
            WO.fire("exportdoc")
        })
    }),
    WO.registerUI("topbar/fastvisit/upload", function() {
        var e, b = WO.getUI("topbar/fastvisit"), c = b.add("upload", "right", !0), d = "upload-btn-" + +(new Date).toString(36);
        $(c.getElement()).attr("id", d),
        WO.on("needflash", function() {
            WO.fire("confirm", {
                title: "提示",
                message: '当前浏览器 Flash <span style="color:red;">不支持</span>, 请安装 Flash 最新版再使用上传功能。<p style="text-align:center;">   <a href="http://www.adobe.com/go/getflashplayer" target="_blank">       <img border="0" src="http://www.adobe.com/macromedia/style_guide/images/160x41_Get_Flash_Player.jpg" alt="获取最新版 flash player" />   </a></p>',
                textOk: "确定"
            })
        }),
        WebUploader.Uploader.support() ? (e = WebUploader.create({
            pick: {
                id: "#" + d,
                multiple: !1
            },
            accept: {
                title: "word文档",
                extensions: "doc,docx",
                mimeTypes: "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
            },
            fileSingleSizeLimit: 512e4,
            swf: WO.uploaderSwfUrl,
            server: WO.uploaderServerUrl,
            fileVal: WO.uploaderFieldName,
            duplicate: !0
        }),
        e.on("filesQueued", function() {
            WO.doc.upload(e),
            e.upload(),
            e.disable()
        }),
        e.on("uploadFinished", function() {
            e.enable()
        }),
        e.on("all", function() {
            var a = $.extend([], arguments);
            return a[0] = "uploader_" + a[0],
            WO.editor.fireEvent.apply(WO.editor, a)
        }),
        e.on("uploadBeforeSend", function(a, b) {
            b["_COOKIE"] = document.cookie
        }),
        WO.webuploader = e) : $(c.getElement()).on("click", function() {
            WO.fire("needflash")
        })
    }),
    function() {
        var a = {}
          , b = window.FUIToolbar = {
            getToolbar: function(a, b) {
                return new c(a,b)
            },
            registerWidgetHandler: function(b, c) {
                $.each(b.split(/\s+/), function(b, d) {
                    a[d] = c
                })
            }
        }
          , c = function(a, b) {
            this.targetId = a,
            this.editor = b,
            this.$toolbar = null ,
            this.$tabList = null ,
            this.$tabContent = null ,
            this.init()
        }
        ;
        c.prototype = {
            init: function() {
                this.initContainer(),
                this.initMainTabs()
            },
            initContainer: function() {
                this.$toolbar = $("#" + this.targetId),
                this.$tabList = $('<div class="tab-list"></div>').appendTo(this.$toolbar),
                this.$tabContent = $('<div class="tab-content"></div>').appendTo(this.$toolbar),
                this.$popupContainer = $('<div class="popup-container"></div>').appendTo(this.$toolbar)
            },
            initMainTabs: function() {
                var c = this;
                c.tabwidget = FUI.Creator.parse(b.MainConfig),
                c.tabwidget.appendButtonTo(c.$tabList[0]),
                c.tabwidget.appendPanelTo(c.$tabContent[0]),
                WO.ConfigTraveller(b.MainConfig, function(b) {
                    var d = a[b.clazz]
                      , e = FUI.widgets[b.id];
                    e && d && d.call(c, b, e, c.editor)
                })
            }
        }
    }(),
    function() {
        FUIToolbar.MainConfig = {
            clazz: "Tabs",
            className: "wo-tabs",
            buttons: [],
            panels: []
        }
    }(),
    function() {
        var a = {
            clazz: "InputMenu",
            id: "fontfamily",
            className: "wo-input-menu-fontfamily",
            text: "字体格式",
            select: 0,
            input: {
                placeholder: "字体格式"
            },
            menu: {
                items: function() {
                    var a = [];
                    return $.each([{
                        name: "songti",
                        val: "宋体,SimSun"
                    }, {
                        name: "yahei",
                        val: "微软雅黑,Microsoft YaHei"
                    }, {
                        name: "kaiti",
                        val: "楷体,楷体_GB2312, SimKai"
                    }, {
                        name: "heiti",
                        val: "黑体, SimHei"
                    }, {
                        name: "lishu",
                        val: "隶书, SimLi"
                    }, {
                        name: "andaleMono",
                        val: "andale mono"
                    }, {
                        name: "arial",
                        val: "arial, helvetica,sans-serif"
                    }, {
                        name: "arialBlack",
                        val: "arial black,avant garde"
                    }, {
                        name: "comicSansMs",
                        val: "comic sans ms"
                    }, {
                        name: "impact",
                        val: "impact,chicago"
                    }, {
                        name: "timesNewRoman",
                        val: "times new roman"
                    }], function(b, c) {
                        a.push({
                            value: c.val,
                            label: {
                                text: c.name,
                                style: {
                                    "font-family": c.val,
                                    "font-size": "18px"
                                }
                            }
                        })
                    }),
                    a
                }()
            }
        }
          , b = {
            clazz: "InputMenu",
            id: "fontsize",
            className: "wo-input-menu-fontsize",
            text: "字号",
            select: 4,
            input: {
                placeholder: "字号"
            },
            menu: {
                items: function() {
                    var a = [];
                    return UE.utils.each([10, 11, 12, 14, 16, 18, 20, 24, 36], function(b) {
                        a.push({
                            value: b + "px",
                            label: {
                                text: b + "px",
                                style: {
                                    "font-size": b + "px"
                                }
                            }
                        })
                    }),
                    a
                }()
            }
        }
          , d = {
            clazz: "ButtonMenu",
            id: "unorderedlist",
            _cmd: "insertunorderedlist",
            className: "wo-btnmenu-unorderedlist",
            text: "编号",
            selected: 1,
            buttons: [{
                className: "fui-button-menu-button"
            }, {
                className: "fui-button-menu-down"
            }],
            menu: {
                items: [{
                    label: "○ 空心项目符号",
                    value: "circle"
                }, {
                    label: "● 实心项目符号",
                    value: "disc"
                }, {
                    label: "■ 方形项目符号",
                    value: "square"
                }]
            }
        }
          , e = {
            clazz: "ButtonMenu",
            id: "orderedlist",
            _cmd: "insertorderedlist",
            className: "wo-btnmenu-orderedlist",
            text: "编号",
            selected: 0,
            buttons: [{
                className: "fui-button-menu-button"
            }, {
                className: "fui-button-menu-down"
            }],
            menu: {
                items: [{
                    label: "1., 2., 3., 4.,  ",
                    value: "decimal"
                }, {
                    label: "a., b., c., d.,  ",
                    value: "lower-alpha"
                }, {
                    label: "i., ii., iii., iv.,  ",
                    value: "lower-roman"
                }, {
                    label: "A., B., C., D.,  ",
                    value: "upper-alpha"
                }, {
                    label: "I., II., III., IV.,  ",
                    value: "upper-roman"
                }]
            }
        }
          , f = {
            clazz: "ButtonMenu",
            id: "rowspacingtop",
            className: "wo-btnmenu-rowspacingtop",
            text: "段前距",
            selected: 0,
            buttons: [{
                className: "fui-button-menu-button"
            }, {
                className: "fui-button-menu-down"
            }],
            menu: {
                items: [{
                    label: "5px",
                    value: 5
                }, {
                    label: "10px",
                    value: 10
                }, {
                    label: "15px",
                    value: 15
                }, {
                    label: "20px",
                    value: 20
                }, {
                    label: "25px",
                    value: 25
                }]
            }
        }
          , g = {
            clazz: "ButtonMenu",
            id: "rowspacingbottom",
            className: "wo-btnmenu-rowspacingbottom",
            text: "段后距",
            selected: 0,
            buttons: [{
                className: "fui-button-menu-button"
            }, {
                className: "fui-button-menu-down"
            }],
            menu: {
                items: [{
                    label: "5px",
                    value: 5
                }, {
                    label: "10px",
                    value: 10
                }, {
                    label: "15px",
                    value: 15
                }, {
                    label: "20px",
                    value: 20
                }, {
                    label: "25px",
                    value: 25
                }]
            }
        }
          , h = {
            clazz: "ButtonMenu",
            id: "lineheight",
            className: "wo-btnmenu-lineheight",
            text: "行高",
            selected: 0,
            buttons: [{
                className: "fui-button-menu-button"
            }, {
                className: "fui-button-menu-down"
            }],
            menu: {
                items: function() {
                    var a = [];
                    return UE.utils.each([1, 1.5, 1.75, 2, 3, 4, 5], function(b) {
                        a.push({
                            value: b,
                            label: b
                        })
                    }),
                    a
                }()
            }
        }
          , i = {
            clazz: "DropPanel",
            id: "fontstyle",
            className: "wo-drop-panel wo-drop-panel-fontstyle",
            button: {
                className: "fui-drop-panel-down"
            }
        };
        FUIToolbar.MainConfig.buttons.push({
            className: "wo-tabs-btn",
            label: "编辑"
        }),
        FUIToolbar.MainConfig.panels.push({
            className: "fui-tab-content fui-tab-content-edit",
            widgets: [{
                clazz: "LabelPanel",
                id: "blockhistory",
                className: "wo-block wo-blockhistory",
                label: "历史记录",
                layout: "top",
                widgets: [{
                    clazz: "Panel",
                    className: "wo-line",
                    widgets: [{
                        clazz: "Button",
                        id: "undo",
                        className: "wo-btn wo-btn-undo",
                        text: "撤销",
                        label: "撤销"
                    }, {
                        clazz: "Button",
                        id: "redo",
                        className: "wo-btn wo-btn-redo",
                        text: "恢复",
                        label: "恢复"
                    }]
                }, {
                    clazz: "Panel",
                    className: "wo-line",
                    widgets: [{
                        clazz: "Button",
                        id: "drafts1",
                        _cmd: "drafts",
                        className: "wo-btn wo-btn-drafts",
                        text: "草稿箱",
                        label: "草稿箱",
                        layout: "bottom"
                    }]
                }]
            }, {
                clazz: "LabelPanel",
                id: "blockclipboard",
                className: "wo-block wo-blockclipboard",
                label: "剪贴板",
                layout: "top",
                widgets: [{
                    clazz: "Panel",
                    className: "wo-line",
                    column: !0,
                    widgets: [{
                        clazz: "Button",
                        id: "copy",
                        className: "wo-btn wo-btn-copy",
                        text: "复制",
                        label: "复制"
                    }, {
                        clazz: "Button",
                        id: "cut",
                        className: "wo-btn wo-btn-cut",
                        text: "剪切",
                        label: "剪切"
                    }]
                }, {
                    clazz: "Panel",
                    className: "wo-line",
                    widgets: [{
                        clazz: "Button",
                        id: "paste",
                        className: "wo-btn wo-btn-paste",
                        text: "粘贴",
                        label: "粘贴",
                        layout: "bottom"
                    }]
                }]
            }, {
                clazz: "LabelPanel",
                id: "blockfont",
                className: "wo-block wo-blockfont",
                label: "字体",
                layout: "top",
                column: !0,
                widgets: [{
                    clazz: "Panel",
                    className: "wo-line wo-line-1",
                    widgets: [a, {
                        clazz: "Button",
                        id: "removeformat",
                        className: "wo-btn wo-btn-removeformat",
                        label: "清除格式",
                        text: "清除格式"
                    }, {
                        clazz: "Button",
                        id: "autotypeset",
                        className: "wo-btn wo-btn-autotypeset",
                        label: "自动格式化",
                        text: "自动格式化"
                    }, {
                        clazz: "Button",
                        id: "formatmatch",
                        className: "wo-btn wo-btn-formatmatch",
                        label: "格式刷",
                        text: "格式刷"
                    }]
                }, {
                    clazz: "Panel",
                    className: "wo-line wo-line-2",
                    widgets: [b, {
                        clazz: "Button",
                        id: "upsize",
                        className: "wo-btn wo-btn-upsize",
                        text: "增大字体"
                    }, {
                        clazz: "Button",
                        id: "downsize",
                        className: "wo-btn wo-btn-downsize",
                        text: "缩小字体"
                    }, {
                        clazz: "Button",
                        id: "subscript",
                        className: "wo-btn wo-btn-subscript",
                        text: "上标"
                    }, {
                        clazz: "Button",
                        id: "superscript",
                        className: "wo-btn wo-btn-superscript",
                        text: "下标"
                    }, {
                        clazz: "Button",
                        id: "bold",
                        className: "wo-btn wo-btn-bold",
                        text: "加粗"
                    }, {
                        clazz: "Button",
                        id: "italic",
                        className: "wo-btn wo-btn-italic",
                        text: "倾斜"
                    }, {
                        clazz: "Button",
                        id: "underline",
                        className: "wo-btn wo-btn-underline",
                        text: "下划线"
                    }, {
                        clazz: "Button",
                        id: "strikethrough",
                        className: "wo-btn wo-btn-strikethrough",
                        text: "删除线"
                    }, {
                        clazz: "Button",
                        id: "forecolor",
                        className: "wo-btn wo-btn-forecolor",
                        text: "文字颜色"
                    }, {
                        clazz: "Button",
                        id: "backcolor",
                        className: "wo-btn wo-btn-backcolor",
                        text: "背景颜色"
                    }]
                }]
            }, {
                clazz: "LabelPanel",
                id: "blockparagraph",
                className: "wo-block wo-blockparagraph",
                label: "段落",
                layout: "top",
                column: !0,
                widgets: [{
                    clazz: "Panel",
                    className: "wo-line wo-line-1",
                    widgets: [{
                        clazz: "Button",
                        id: "justifyleft",
                        className: "wo-btn wo-btn-justifyleft",
                        text: "向左对齐"
                    }, {
                        clazz: "Button",
                        id: "justifycenter",
                        className: "wo-btn wo-btn-justifycenter",
                        text: "居中对齐"
                    }, {
                        clazz: "Button",
                        id: "justifyright",
                        className: "wo-btn wo-btn-justifyright",
                        text: "向右对齐"
                    }, {
                        clazz: "Button",
                        id: "justifyjustify",
                        className: "wo-btn wo-btn-justifyjustify",
                        text: "两端对齐"
                    }, {
                        clazz: "Button",
                        id: "blockquote",
                        className: "wo-btn wo-btn-blockquote",
                        text: "引用"
                    }, {
                        clazz: "Button",
                        id: "blockindent",
                        className: "wo-btn wo-btn-blockindent",
                        text: "增加缩进"
                    }, {
                        clazz: "Button",
                        id: "blockoutdent",
                        className: "wo-btn wo-btn-blockoutdent",
                        text: "减少缩进"
                    }]
                }, {
                    clazz: "Panel",
                    className: "wo-line wo-line-2",
                    widgets: [d, e, f, g, h]
                }]
            }, {
                clazz: "LabelPanel",
                id: "blockstyle",
                className: "wo-block wo-blockstyle",
                label: "样式",
                layout: "top",
                widgets: [i]
            }]
        })
    }(),
    function() {
        FUIToolbar.MainConfig.buttons.push({
            className: "wo-tabs-btn",
            label: "插入"
        }),
        FUIToolbar.MainConfig.panels.push({
            className: "fui-tab-content fui-tab-content-insert",
            widgets: [{
                clazz: "LabelPanel",
                id: "blockpage",
                className: "wo-block wo-blockpage",
                layout: "top",
                label: "页",
                widgets: [{
                    clazz: "Button",
                    id: "horizontal",
                    className: "wo-btn wo-btn-horizontal",
                    text: "分页符",
                    label: "分页符",
                    layout: "bottom"
                }]
            }, {
                clazz: "LabelPanel",
                id: "blockchar",
                className: "wo-block wo-blockchar",
                layout: "top",
                label: "字符",
                widgets: [{
                    clazz: "Button",
                    id: "spechars",
                    className: "wo-btn wo-btn-spechars",
                    text: "字符",
                    label: "字符",
                    layout: "bottom",
                    _dialog: {
                        width: 620,
                        height: 575,
                        caption: "插入字符"
                    }
                }]
            }, {
                clazz: "LabelPanel",
                id: "blocklink",
                className: "wo-block wo-blocklink",
                layout: "top",
                label: "链接",
                column: !0,
                widgets: [{
                    clazz: "Button",
                    id: "link",
                    className: "wo-btn wo-btn-link",
                    text: "添加链接",
                    label: "添加链接",
                    _dialog: {
                        width: 420,
                        height: 250,
                        caption: "添加链接"
                    }
                }, {
                    clazz: "Button",
                    id: "unlink",
                    className: "wo-btn wo-btn-unlink",
                    text: "取消链接",
                    label: "取消链接"
                }]
            }, {
                clazz: "LabelPanel",
                id: "blockimage",
                className: "wo-block wo-blockimage",
                layout: "top",
                label: "图片",
                widgets: [{
                    clazz: "Button",
                    id: "insertimage",
                    className: "wo-btn wo-btn-insertimage",
                    text: "图片",
                    label: "图片",
                    layout: "bottom",
                    _dialog: {
                        width: 650,
                        height: 470,
                        caption: "插入图片"
                    }
                }, {
                    clazz: "Panel",
                    className: "wo-line",
                    widgets: [{
                        clazz: "Panel",
                        className: "wo-line",
                        column: !0,
                        widgets: [{
                            clazz: "Panel",
                            className: "wo-line wo-line-1",
                            widgets: [{
                                clazz: "Button",
                                id: "simpleupload",
                                className: "wo-btn wo-btn-simpleupload",
                                text: "单图上传",
                                label: "单图"
                            }, {
                                clazz: "Button",
                                id: "emotion",
                                className: "wo-btn wo-btn-emotion",
                                text: "表情",
                                label: "表情",
                                _popup: {
                                    caption: "插入表情",
                                    iframe: !0
                                }
                            }]
                        }, {
                            clazz: "Panel",
                            className: "wo-line wo-line-2",
                            widgets: [{
                                clazz: "Button",
                                id: "snapscreen",
                                className: "wo-btn wo-btn-snapscreen",
                                text: "截屏",
                                label: "截屏"
                            }, {
                                clazz: "Button",
                                id: "scrawl",
                                className: "wo-btn wo-btn-scrawl",
                                text: "涂鸦",
                                label: "涂鸦",
                                _dialog: {
                                    width: 520,
                                    height: 430,
                                    caption: "插入涂鸦"
                                }
                            }]
                        }]
                    }]
                }]
            }, {
                clazz: "LabelPanel",
                id: "blockmap",
                className: "wo-block wo-blockmap",
                layout: "top",
                label: "地图",
                column: !0,
                widgets: [{
                    clazz: "Button",
                    id: "map",
                    className: "wo-btn wo-btn-map",
                    text: "地图",
                    label: "地图",
                    layout: "bottom",
                    _dialog: {
                        width: 570,
                        height: 460,
                        caption: "插入地图"
                    }
                }]
            }, {
                clazz: "LabelPanel",
                id: "blockcode",
                className: "wo-block wo-blockcode",
                layout: "top",
                label: "代码",
                widgets: [{
                    clazz: "Button",
                    id: "insertcode",
                    className: "wo-btn wo-btn-insertcode",
                    text: "代码",
                    label: "代码",
                    layout: "bottom"
                }]
            }, {
                clazz: "LabelPanel",
                id: "blocktable",
                className: "wo-block wo-blocktable",
                layout: "top",
                label: "表格",
                widgets: [{
                    clazz: "TablePicker",
                    id: "inserttable1",
                    _cmd: "inserttable",
                    button: {
                        className: "wo-btn wo-btn-inserttable",
                        text: "表格",
                        label: "表格",
                        layout: "bottom"
                    }
                }]
            }, {
                clazz: "LabelPanel",
                id: "blockformula",
                className: "wo-block wo-blockformula",
                layout: "top",
                label: "公式",
                widgets: [{
                    clazz: "Button",
                    id: "formula",
                    className: "wo-btn wo-btn-insertformula",
                    text: "公式",
                    label: "公式",
                    layout: "bottom",
                    _popup: {
                        width: 600,
                        height: 400,
                        caption: "插入公式"
                    }
                }]
            }, {
                clazz: "LabelPanel",
                id: "blockcomment",
                className: "wo-block wo-blockcomment",
                layout: "top",
                label: "批注",
                widgets: [{
                    clazz: "Button",
                    id: "comment",
                    className: "wo-btn wo-btn-comment",
                    text: "批注",
                    label: "批注",
                    layout: "bottom",
                    _dialog: {
                        width: 600,
                        height: 400,
                        caption: "添加批注"
                    }
                }]
            }]
        })
    }(),
    function() {
        FUIToolbar.MainConfig.buttons.push({
            className: "wo-tabs-btn",
            label: "表格"
        }),
        FUIToolbar.MainConfig.panels.push({
            className: "fui-tab-content fui-tab-content-table",
            widgets: [{
                clazz: "LabelPanel",
                id: "blocktable",
                className: "wo-block wo-blocktable",
                layout: "top",
                label: "表格",
                widgets: [{
                    clazz: "Panel",
                    widgets: [{
                        clazz: "TablePicker",
                        id: "inserttable2",
                        _cmd: "inserttable",
                        button: {
                            className: "wo-btn wo-btn-inserttable",
                            text: "插入表格",
                            label: "插入表格",
                            layout: "bottom"
                        }
                    }, {
                        clazz: "Button",
                        id: "deletetable",
                        className: "wo-btn wo-btn-deletetable",
                        text: "删除表格",
                        label: "删除表格",
                        layout: "bottom"
                    }]
                }, {
                    clazz: "Panel",
                    column: !0,
                    widgets: [{
                        clazz: "Panel",
                        widgets: [{
                            clazz: "Button",
                            id: "insertrow",
                            className: "wo-btn wo-btn-insertrow",
                            text: "插入行"
                        }, {
                            clazz: "Button",
                            id: "insertcol",
                            className: "wo-btn wo-btn-insertcol",
                            text: "插入列"
                        }]
                    }, {
                        clazz: "Panel",
                        widgets: [{
                            clazz: "Button",
                            id: "deleterow",
                            className: "wo-btn wo-btn-deleterow",
                            text: "删除行"
                        }, {
                            clazz: "Button",
                            id: "deletecol",
                            className: "wo-btn wo-btn-deletecol",
                            text: "删除列"
                        }]
                    }]
                }]
            }, {
                clazz: "LabelPanel",
                id: "blockmergecells",
                className: "wo-block wo-blockmergecells",
                layout: "top",
                label: "合并单元格",
                column: !0,
                widgets: [{
                    clazz: "Panel",
                    widgets: [{
                        clazz: "Button",
                        id: "mergecells",
                        className: "wo-btn wo-btn-mergecells",
                        text: "合并单元格"
                    }, {
                        clazz: "Button",
                        id: "mergedown",
                        className: "wo-btn wo-btn-mergedown",
                        text: "向下合并单元格"
                    }, {
                        clazz: "Button",
                        id: "mergeright",
                        className: "wo-btn wo-btn-mergeright",
                        text: "向右合并单元格"
                    }]
                }, {
                    clazz: "Panel",
                    widgets: [{
                        clazz: "Button",
                        id: "splittocells",
                        className: "wo-btn wo-btn-splittocells",
                        text: "拆分单元格"
                    }, {
                        clazz: "Button",
                        id: "splittocols",
                        className: "wo-btn wo-btn-splittocols",
                        text: "单元格拆分成列"
                    }, {
                        clazz: "Button",
                        id: "splittorows",
                        className: "wo-btn wo-btn-splittorows",
                        text: "单元格拆分成行"
                    }]
                }]
            }]
        })
    }(),
    function() {
        FUIToolbar.MainConfig.buttons.push({
            className: "wo-tabs-btn",
            label: "视图"
        }),
        FUIToolbar.MainConfig.panels.push({
            className: "fui-tab-content fui-tab-content-edit",
            widgets: [{
                clazz: "LabelPanel",
                id: "blockdirectory",
                className: "wo-block wo-blockdirectory",
                layout: "top",
                label: "目录",
                widgets: [{
                    clazz: "Button",
                    id: "directory",
                    className: "wo-btn wo-btn-directory",
                    text: "显示目录",
                    label: "显示目录",
                    layout: "bottom"
                }]
            }, {
                clazz: "LabelPanel",
                id: "blockshowcomment",
                className: "wo-block wo-blockshowcomment",
                layout: "top",
                label: "批注",
                widgets: [{
                    clazz: "Button",
                    id: "showcomment",
                    className: "wo-btn wo-btn-showcomment",
                    text: "显示批注",
                    label: "显示批注",
                    layout: "bottom"
                }]
            }, {
                clazz: "LabelPanel",
                id: "blockpreview",
                className: "wo-block wo-blockpreview",
                layout: "top",
                label: "预览",
                widgets: [{
                    clazz: "Button",
                    id: "preview",
                    className: "wo-btn wo-btn-preview",
                    text: "预览文档",
                    label: "预览文档",
                    layout: "bottom"
                }]
            }]
        })
    }(),
    function() {
        FUIToolbar.MainConfig.buttons.push({
            className: "wo-tabs-btn",
            label: "工具"
        }),
        FUIToolbar.MainConfig.panels.push({
            className: "fui-tab-content fui-tab-content-edit",
            widgets: [{
                clazz: "LabelPanel",
                id: "blockdrafts",
                className: "wo-block wo-blockdrafts",
                layout: "top",
                label: "草稿箱",
                widgets: [{
                    clazz: "Button",
                    id: "drafts2",
                    _cmd: "drafts",
                    className: "wo-btn wo-btn-drafts",
                    text: "草稿箱",
                    label: "草稿箱",
                    layout: "bottom"
                }]
            }, {
                clazz: "LabelPanel",
                id: "blockprint",
                className: "wo-block wo-blockprint",
                layout: "top",
                label: "打印",
                widgets: [{
                    clazz: "Button",
                    id: "print",
                    className: "wo-btn wo-btn-print",
                    text: "打印文档",
                    label: "打印文档",
                    layout: "bottom"
                }]
            }, {
                clazz: "LabelPanel",
                id: "blocksearch",
                className: "wo-block wo-blocksearch",
                layout: "top",
                label: "搜索",
                widgets: [{
                    clazz: "Button",
                    id: "searchreplace",
                    className: "wo-btn wo-btn-searchreplace",
                    text: "查找替换",
                    label: "查找替换",
                    layout: "bottom",
                    _dialog: {
                        width: 400,
                        height: 290,
                        caption: "查找替换"
                    }
                }]
            }, {
                clazz: "LabelPanel",
                id: "blockwordcount",
                className: "wo-block wo-blockwordcount",
                layout: "top",
                label: "字数统计",
                widgets: [{
                    clazz: "Button",
                    id: "wordcount",
                    className: "wo-btn wo-btn-wordcount",
                    text: "字数统计",
                    label: "字数统计",
                    layout: "bottom",
                    _dialog: {
                        width: 340,
                        height: 260,
                        caption: "字数统计"
                    }
                }]
            }, {
                clazz: "LabelPanel",
                id: "blockcoordination",
                className: "wo-block wo-blockcoordination",
                layout: "top",
                label: "协同",
                widgets: [{
                    clazz: "Button",
                    id: "coordination",
                    className: "wo-btn wo-btn-coordination",
                    text: "共享给好友",
                    label: "共享给好友",
                    layout: "bottom",
                    _dialog: {
                        width: 600,
                        height: 400,
                        caption: "共享给好友"
                    }
                }]
            }, {
                clazz: "LabelPanel",
                id: "blockshare",
                className: "wo-block wo-blockshare",
                layout: "top",
                label: "分享",
                widgets: [{
                    clazz: "Button",
                    id: "share",
                    className: "wo-btn wo-btn-share",
                    text: "分享",
                    label: "分享",
                    layout: "bottom"
                }]
            }]
        })
    }(),
    function() {
        WO.ConfigTraveller = function(a, b) {
            var c, d;
            if (a && (b(a),
            c = "Tabs" === a.clazz ? a.panels : a.widgets,
            c && c.length))
                for (d = 0; d < c.length; d++)
                    WO.ConfigTraveller(c[d], b)
        }
        ,
        WO.ConfigTraveller(FUIToolbar.MainConfig, function(a) {
            a.clazz && a.id && (a._cmd = a._cmd || a.id,
            a._dialog && (a._dialog.className = "wo-dialog wo-dialog-" + a.id),
            a._popup && (a._popup.className = "wo-popup wo-popup-" + a.id))
        })
    }(),
    function() {
        function a(a, b, c) {
            var f, g, h, i, j, k, e = a._cmd;
            a._dialog && (f = WO.WO_URL + "dialogs/",
            g = a._dialog,
            h = "wo_" + (+new Date).toString(36),
            i = new FUI.Dialog(g),
            j = $(i.getBodyElement()),
            k = $EDITORUI[h] = {
                _ishidden: !0,
                editor: c,
                className: "wo-dialog-" + e,
                uiName: "dialog",
                onok: function() {},
                onclose: function() {},
                oncancel: function() {},
                dialog: i,
                reset: function() {
                    j.html('<iframe id="' + h + '_iframe" width="100%" height="' + (g.height - 70) + '" class="wo-dialog-iframe" src="' + f + e + "/" + e + '.html" frameborder="0">')
                },
                open: function() {
                    i.open()
                },
                close: function() {
                    i.close()
                },
                isHidden: function() {
                    return k._ishidden
                },
                buttons: i.getButtons()
            },
            i.on("ok", function() {
                return k.onok.apply(c, arguments) === !1 ? !1 : void 0
            }),
            i.on("close", function() {
                k.onclose.apply(c, arguments),
                setTimeout(function() {
                    j.html("")
                })
            }),
            i.on("cancel", function() {
                k.oncancel.apply(c, arguments)
            }),
            i.on("open", function() {
                k._ishidden = !1
            }),
            i.on("close", function() {
                k._ishidden = !0
            }),
            i.positionTo(document.body),
            b.on("click", function() {
                k.reset(),
                i.open()
            }),
            WO.on("esc", function() {
                return i.isOpen() ? (i.close(),
                !0) : void 0
            }))
        }
        function b(a, b, c) {
            var f, g, h, i, j, k, e = a._cmd;
            a._popup && (f = WO.WO_URL + "dialogs/",
            g = a._popup,
            h = "wo_" + (+new Date).toString(36),
            i = new FUI.Popup(g),
            j = $(i.getElement()).find(".fui-panel-content"),
            k = $EDITORUI[h] = {
                _ishidden: !0,
                editor: c,
                className: "wo-dialog-" + e,
                uiName: "popup",
                onok: function() {},
                onclose: function() {},
                oncancel: function() {},
                popup: i,
                reset: function() {
                    j.html('<iframe id="' + h + '_iframe" class="wo-dialog-iframe" src="' + f + e + "/" + e + '.html" frameborder="0">')
                },
                open: function() {
                    i.show()
                },
                close: function() {
                    i.close()
                },
                isHidden: function() {
                    return k._ishidden
                },
                getDom: function(a) {
                    var b;
                    return b = "iframe" == a ? j.find("iframe")[0] : "body" == a || "content" == a ? j[0] : i.getElement()
                }
            },
            i.positionTo(b),
            b.on("click", function() {
                k.reset(),
                i.show()
            }))
        }
        function c(a, b, c) {
            c.on("zeroclipboardready", function(a, d) {
                d.clip(b.getElement()),
                d.on("copy", function() {
                    "cut" == arguments[0].target.id && c.execCommand("inserthtml", UE.dom.domUtils.fillChar)
                })
            })
        }
        function d(a, b, c) {
            c.fireEvent.call(c, "simpleuploadbtnready", b.getElement())
        }
        function e() {}
        FUIToolbar.registerWidgetHandler("Button", function(f, g, h) {
            var k, j = f._cmd;
            return "forecolor" == j || "backcolor" == j ? (k = new FUI.ColorPicker({
                clearText: "清除颜色",
                commonText: "通用颜色",
                standardText: "标准颜色",
                resize: "none"
            }),
            k.attachTo(g),
            k.on("selectcolor", function(a, b) {
                h.execCommand(j, b)
            })) : f._dialog || f._popup || g.on("click", function() {
                h.execCommand(j)
            }),
            h.on("selectionchange", function() {
                var a = h.queryCommandState(j);
                g[-1 == a ? "disable" : "enable"](),
                g[1 == a ? "addClass" : "removeClass"]("fui-button-pressed")
            }),
            ("copy" == f.id || "cut" == f.id) && c.call(this, f, g, h),
            "simpleupload" == f.id && d.call(this, f, g, h),
            "preview" == f.id && e.call(this, f, g, h),
            a.call(this, f, g, h),
            b.call(this, f, g, h),
            g
        })
    }(),
    FUIToolbar.registerWidgetHandler("InputMenu", function(a, b, c) {
        function f(a) {
            a && (b.selectByValue(a) || b.clearSelect(),
            h(a),
            b.setValue(a))
        }
        function h(c) {
            "fontfamily" == d && $.each(a.menu.items, function(a, b) {
                return b.value.replace(/[', ]/g, "") == c.replace(/[', ]/g, "") ? (c = b.label.text,
                !1) : void 0
            }),
            b.__inputWidget.setValue(c)
        }
        function i() {
            return b.__inputWidget.getValue()
        }
        var d = a._cmd;
        return a.menu.items,
        "fontfamily" == d && $(".fui-input", b.getElement()).attr({
            readonly: "readonly",
            unselectable: "on"
        }),
        b.on("itemclick inputcomplete", function(a, b) {
            var e = b.value;
            "fontsize" == d && /^[\d]+$/.test(e) && (e += "px"),
            c.execCommand(d, e)
        }),
        c.on("selectionchange", function() {
            var e, a = c.queryCommandState(d);
            b[-1 == a ? "disable" : "enable"](),
            b[1 == a ? "addClass" : "removeClass"]("fui-button-pressed"),
            e = c.queryCommandValue(d),
            f(e)
        }),
        b.__menuWidget.on("inputcomplete", function() {
            b.setValue(i())
        }),
        b
    }),
    FUIToolbar.registerWidgetHandler("ButtonMenu", function(a, b, c) {
        var d = a._cmd;
        return a.menu.items,
        b.on("btnclick", function(a) {
            $(a.target).hasClass("fui-button-menu-down") || c.execCommand(d, b.getValue())
        }),
        b.on("select", function() {
            c.execCommand(d, b.getValue())
        }),
        b
    }),
    FUIToolbar.registerWidgetHandler("DropPanel", function(a, b, c) {
        var d = a._cmd
          , e = WO.WO_URL
          , f = {
            className: "wo-fontstyle-buttonset",
            selected: 2,
            buttons: [{
                text: "标",
                icon: e + "assets/images/fontstyle/style_01.png",
                value: {
                    tagName: "p",
                    style: "font-size: 14px; font-style: normal; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: normal; text-decoration: none; color: #000000;"
                }
            }, {
                text: "无间隔​",
                icon: e + "assets/images/fontstyle/style_02.png",
                value: {
                    tagName: "p",
                    style: "font-size: 14px; font-style: normal; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: bold; text-decoration: none; color: #000000;"
                }
            }, {
                text: "标题 1​",
                icon: e + "assets/images/fontstyle/style_03.png",
                value: {
                    tagName: "h1",
                    style: "font-size: 29px; font-style: normal; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: bold; text-decoration: none; color: #000000;"
                }
            }, {
                text: "标题 2​",
                icon: e + "assets/images/fontstyle/style_04.png",
                value: {
                    tagName: "h2",
                    style: "font-size: 21px; font-style: normal; font-family: Cambria, serif; font-weight: bold; text-decoration: none; color: #000000;"
                }
            }, {
                text: "标题 3​",
                icon: e + "assets/images/fontstyle/style_05.png",
                value: {
                    tagName: "h3",
                    style: "font-size: 21px; font-style: normal; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: bold; text-decoration: none; color: #000000;"
                }
            }, {
                text: "标题 4​",
                icon: e + "assets/images/fontstyle/style_06.png",
                value: {
                    tagName: "h4",
                    style: "font-size: 19px; font-style: normal; font-family: Cambria, serif; font-weight: bold; text-decoration: none; color: #000000;"
                }
            }, {
                text: "标题 5​",
                icon: e + "assets/images/fontstyle/style_07.png",
                value: {
                    tagName: "h5",
                    style: "font-size: 19px; font-style: normal; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: bold; text-decoration: none; color: #000000;"
                }
            }, {
                text: "标题 6​",
                icon: e + "assets/images/fontstyle/style_08.png",
                value: {
                    tagName: "h6",
                    style: "font-size: 16px; font-style: normal; font-family: Cambria, serif; font-weight: bold; text-decoration: none; color: #000000;"
                }
            }, {
                text: "标题 7​",
                icon: e + "assets/images/fontstyle/style_09.png",
                value: {
                    tagName: "p",
                    style: "font-size: 16px; font-style: normal; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: bold; text-decoration: none; color: #000000;"
                }
            }, {
                text: "标题 8​",
                icon: e + "assets/images/fontstyle/style_10.png",
                value: {
                    tagName: "p",
                    style: "font-size: 16px; font-style: normal; font-family: Cambria, serif; font-weight: normal; text-decoration: none; color: #000000;"
                }
            }, {
                text: "标题 9​",
                icon: e + "assets/images/fontstyle/style_11.png",
                value: {
                    tagName: "p",
                    style: "font-size: 14px; font-style: normal; font-family: Cambria, serif; font-weight: normal; text-decoration: none; color: #000000;"
                }
            }, {
                text: "标题​",
                icon: e + "assets/images/fontstyle/style_12.png",
                value: {
                    tagName: "p",
                    style: "font-size: 21px; font-style: normal; font-family: Cambria, serif; font-weight: bold; text-decoration: none; color: #000000;"
                }
            }, {
                text: "副标题​",
                icon: e + "assets/images/fontstyle/style_13.png",
                value: {
                    tagName: "p",
                    style: "font-size: 21px; font-style: normal; font-family: Cambria, serif; font-weight: bold; text-decoration: none; color: #000000;"
                }
            }, {
                text: "不明显强调​",
                icon: e + "assets/images/fontstyle/style_14.png",
                value: {
                    tagName: "p",
                    style: "font-size: 14px; font-style: italic; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: normal; text-decoration: none; color: #404040;"
                }
            }, {
                text: "强调​",
                icon: e + "assets/images/fontstyle/style_15.png",
                value: {
                    tagName: "p",
                    style: "font-size: 14px; font-style: italic; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: normal; text-decoration: none; color: #000000;"
                }
            }, {
                text: "明显强调​",
                icon: e + "assets/images/fontstyle/style_16.png",
                value: {
                    tagName: "p",
                    style: "font-size: 14px; font-style: italic; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: normal; text-decoration: none; color: #4f81bd;"
                }
            }, {
                text: "增强​",
                icon: e + "assets/images/fontstyle/style_17.png",
                value: {
                    tagName: "p",
                    style: "font-size: 14px; font-style: normal; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: bold; text-decoration: none; color: #000000;"
                }
            }, {
                text: "引用​",
                icon: e + "assets/images/fontstyle/style_18.png",
                value: {
                    tagName: "p",
                    style: "font-size: 14px; font-style: italic; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: normal; text-decoration: none; color: #404040;"
                }
            }, {
                text: "明显引用​",
                icon: e + "assets/images/fontstyle/style_19.png",
                value: {
                    tagName: "p",
                    style: "font-size: 14px; font-style: italic; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: bold; text-decoration: none; color: #4f81bd;"
                }
            }, {
                text: "不明显参考​",
                icon: e + "assets/images/fontstyle/style_20.png",
                value: {
                    tagName: "p",
                    style: "font-size: 14px; font-style: normal; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: normal; text-decoration: none; color: #5a5a5a;"
                }
            }, {
                text: "明显参考​",
                icon: e + "assets/images/fontstyle/style_21.png",
                value: {
                    tagName: "p",
                    style: "font-size: 14px; font-style: normal; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: bold; text-decoration: underline; color: #c0504d;"
                }
            }, {
                text: "书籍标题​",
                icon: e + "assets/images/fontstyle/style_22.png",
                value: {
                    tagName: "p",
                    style: "font-size: 14px; font-style: italic; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: bold; text-decoration: none; color: #000000;"
                }
            }, {
                text: "列出段落​",
                icon: e + "assets/images/fontstyle/style_23.png",
                value: {
                    tagName: "p",
                    style: "font-size: 14px; font-style: normal; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: normal; text-decoration: none; color: #000000;"
                }
            }, {
                text: "caption​",
                icon: e + "assets/images/fontstyle/style_24.png",
                value: {
                    tagName: "p",
                    style: "font-size: 13px; font-style: normal; font-family: Cambria, serif; font-weight: normal; text-decoration: none; color: #000000;"
                }
            }, {
                text: "toc 1​",
                icon: e + "assets/images/fontstyle/style_25.png",
                value: {
                    tagName: "p",
                    style: "font-size: 15px; font-style: normal; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: normal; text-decoration: none; color: #000000;"
                }
            }, {
                text: "toc 2​",
                icon: e + "assets/images/fontstyle/style_26.png",
                value: {
                    tagName: "p",
                    style: "font-size: 15px; font-style: normal; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: normal; text-decoration: none; color: #000000;"
                }
            }, {
                text: "toc 3​",
                icon: e + "assets/images/fontstyle/style_27.png",
                value: {
                    tagName: "p",
                    style: "font-size: 15px; font-style: normal; font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 微软雅黑, SimSun, 宋体, sans-serif; font-weight: normal; text-decoration: none; color: #000000;"
                }
            }, {
                text: "TOC Heading​",
                icon: e + "assets/images/fontstyle/style_28.png",
                value: {
                    tagName: "p",
                    style: "font-size: 19px; font-style: normal; font-family: Cambria, serif; font-weight: bold; text-decoration: none; color: #365f91;"
                }
            }]
        }
          , g = new FUI.Buttonset(f);
        return b.appendWidget(g),
        g.on("click", function() {
            var e;
            (e = g.getValue()) && c.execCommand(d, e),
            b.close()
        }),
        b
    }),
    FUIToolbar.registerWidgetHandler("ColorPicker", function(a, b, c) {
        var d = a._cmd
          , e = new FUI.ColorPicker({
            clearText: "清除颜色",
            commonText: "通用颜色",
            standardText: "标准颜色",
            resize: "none"
        });
        return e.attachTo(b),
        e.on("selectcolor", function(a, b) {
            c.execCommand(d, b)
        }),
        b
    }),
    FUIToolbar.registerWidgetHandler("TablePicker", function(a, b, c) {
        var d = a._cmd;
        return b.on("pickerselect", function(a, b) {
            c.execCommand(d, {
                border: 1,
                numCols: b.col,
                numRows: b.row,
                tdvalign: "top"
            })
        }),
        c.on("selectionchange", function() {
            var a = c.queryCommandState(d);
            b[-1 == a ? "disable" : "enable"](),
            b[1 == a ? "addClass" : "removeClass"]("fui-button-pressed")
        }),
        b
    }),
    WO.registerUI("section", function() {
        function g() {
            function h(a) {
                var b = {}
                  , c = [];
                return b.dom = a.dom,
                b.title = a.title,
                b.tag = a.tag.toLowerCase(),
                i(a) && $.each(a.children, function(a, b) {
                    c.push(h(b))
                }),
                c.length && (b.children = c),
                b
            }
            function i(a) {
                return 0 != a.children.length || !1
            }
            function j(a) {
                var b = {
                    "&": "&amp;",
                    "<": "&lt;",
                    ">": "&gt;",
                    '"': "&quot;",
                    "'": "&#39;",
                    "/": "&#x2F;"
                };
                return String(a).replace(/[&<>"'/]/g, function(a) {
                    return b[a]
                })
            }
            var d, a = b.execCommand("getsections"), g = "";
            i(a) ? (d = h(a),
            g = c(d) || e) : g = e,
            $(".section-tree", f).html(j(g))
        }
        var b = WO.editor
          , c = function(a) {
            var b = [];
            return b.push('<ul class="dir-tip">'),
            $.each(a.children, function(a, c) {
                b.push('   <li class="dir-item" data-tagname="' + c.tag + '" title="' + c.title + '">' + c.title + "</li>")
            }),
            b.push("</ul>"),
            b.join("\n")
        }
          , d = ""
          , e = '<div class="section-empty-tip">没有找到目录大纲</div>'
          , f = $('<div class="dir"><div class="s-close">x</div><div class="title">目录大纲</div><div class="section-tree">' + e + "</div></div>").appendTo($(".main"));
        b.on("aftersetcontent contentchange", function() {
            var c = b.getContent();
            c != d && (d = c,
            g())
        }),
        f.delegate(".dir-item", "click", function() {
            var a = $(".main")
              , c = $("li").index(this)
              , d = $(b.iframe)
              , e = $(WO.editor.iframe).contents().find(":header:eq(" + c + ")");
            a.animate({
                scrollTop: e.offset().top + d.offset().top - a.offset().top + a.scrollTop()
            }, 100)
        }),
        b.on("toggledirectory", function() {
            $(".dir").toggle()
        }),
        f.delegate(".s-close", "click", function() {
            $(".dir").fadeOut()
        })
    }),
    WO.registerUI("toolbardock", function() {
        WO.ready(function() {
            function g(a, b, c) {
                b.duration = 200,
                b.easing = "ease",
                b.complete = c,
                a.transition(b)
            }
            var b = !0
              , c = WO.toolbar.$tabContent
              , d = WO.toolbar.$tabList
              , e = WO.toolbar.$toolbar
              , f = $('<div class="toggle-toolbar"><span class="fold-toolbar" id="fold-toolbar" title="折叠工具栏"></span><span class="dock-toolbar" id="dock-toolbar" title="固定工具栏"></span></div>');
            f.appendTo(c),
            $("#fold-toolbar").on("click", function() {
                $(".fui-selected", d).removeClass("fui-selected"),
                f.css("display", "none"),
                g(e, {
                    height: "30px"
                }),
                g($(".main"), {
                    top: "76px"
                }),
                b = !1
            }),
            $(".wo-tabs-btn", WO.toolbar.$tabList).on("click", function() {
                g(e, {
                    height: "142px"
                }, function() {
                    f.css("display", "block")
                }),
                b || ($("#fold-toolbar").css("display", "none"),
                $("#dock-toolbar").css("display", "block"))
            }),
            $("#dock-toolbar").on("click", function() {
                g($(".main"), {
                    top: "188px"
                }),
                b = !0,
                $("#fold-toolbar").css("display", "block"),
                $("#dock-toolbar").css("display", "none")
            }),
            WO.editor.on("keydown mousedown", function() {
                b || $("#fold-toolbar").trigger("click")
            })
        })
    }),
    function() {
        function b(a, b, c, d) {
            var g, h, e = new FUI.Panel({
                className: "wo-filetab-left"
            }), f = new FUI.Panel({
                className: "wo-filetab-right"
            });
            d.appendWidget(e),
            d.appendWidget(f),
            g = new FUI.Button({
                className: "wo-filetab-back",
                label: "回退"
            }),
            e.appendWidget(g),
            $(f.getContentElement()).before('<div class="wo-filetab-right-title">百度Doc</div>'),
            g.on("click", function() {
                d.close()
            }),
            h = FUI.Creator.parse(WO.MenuConfig),
            h.appendButtonTo(e.getContentElement()),
            h.appendPanelTo(f.getContentElement())
        }
        function c(a, c, d) {
            function h() {
                WO.fire("filerefresh")
            }
            var e = this
              , f = new FUI.Popup({
                id: "filetabpopup",
                className: "wo-filetab",
                mask: {
                    className: "wo-filetab-mask"
                }
            })
              , g = $(f.getElement());
            return g.find(".fui-panel-content").addClass("wo-filetab-wrap"),
            f.appendTo(document.body),
            f.positionTo(e.$toolbar[0], "left-top"),
            f._bkopen = f.open,
            f._bkclose = f.close,
            f.open = function() {
                g.css({
                    width: 0,
                    height: 0
                }),
                f._bkopen(),
                g.css({
                    top: 0
                }).animate({
                    width: "100%",
                    height: "100%"
                }, 300, "swing"),
                g.find(".wo-filetab-right").css({
                    "margin-left": "-150px",
                    background: "#fff"
                }).animate({
                    "margin-left": "0"
                }, 400, "swing"),
                !f.isOpen() && h()
            }
            ,
            f.close = function() {
                g.css({
                    width: "100%",
                    height: "100%"
                }),
                f._bkclose(),
                g.animate({
                    width: 0,
                    height: 0
                }, 300, "linear"),
                g.find(".wo-filetab-right").animate({
                    "margin-left": "-150px"
                }, 300, "linear")
            }
            ,
            c.on("click", function() {
                f.open()
            }),
            WO.on("esc", function() {
                var a = 0;
                $(".fui-mask").each(function(b, c) {
                    "none" == $(c).css("display") || $(c).hasClass("wo-filetab-mask") || a++
                }),
                a || f[f.isOpen() ? "close" : "open"](),
                WO.READONLY && $("#fileopen,#openfromwangpan").trigger("click")
            }),
            WO.on("switchtotpl", function() {
                f.open(),
                $("filenew").trigger("click")
            }),
            WO.ready(function() {
                $("#fileopen,#openfromwangpan,#filesave,#savetowangpan").on("click", function() {
                    h()
                })
            }),
            b.call(e, a, c, d, f),
            WO.menu = f,
            c
        }
        var a = {};
        WO.registerWouiHandler = function(b, c) {
            $.each(b.split(/\s+/), function(b, d) {
                a[d] = c
            })
        }
        ,
        WO.initMenu = function() {
            var e = WO.toolbar;
            e.menuButton = new FUI.Button({
                label: "文件",
                className: "wo-btn wo-btn-filetab"
            }),
            e.$tabList.prepend(e.menuButton.getElement()),
            c.call(e, {}, e.menuButton, e.editor),
            WO.ConfigTraveller(WO.MenuConfig, function(b) {
                var c = a[b._name]
                  , d = FUI.widgets[b.id];
                d && c && c.call(e, b, d, e.editor)
            }),
            WO.fire("menuready")
        }
    }(),
    function() {
        WO.MenuConfig = {
            clazz: "Tabs",
            className: "wo-tabs",
            buttons: [{
                clazz: "Button",
                id: "filenew",
                title: "新建",
                label: "新建"
            }, {
                clazz: "Button",
                id: "fileopen",
                title: "打开",
                label: "打开"
            }, {
                clazz: "Button",
                id: "filesave",
                title: "保存",
                label: "保存"
            }, {
                clazz: "Button",
                id: "fileshare",
                title: "分享",
                label: "分享"
            }, {
                clazz: "Button",
                id: "fileprint",
                title: "打印",
                label: "打印"
            }, {
                clazz: "Button",
                id: "filehelp",
                title: "帮助",
                label: "帮助"
            }],
            panels: [{
                clazz: "Panel",
                id: "filepanelnew",
                _name: "filenew"
            }, {
                clazz: "Panel",
                id: "filepanelopen",
                _name: "fileopen"
            }, {
                clazz: "Panel",
                id: "filepanelsave",
                _name: "filesave"
            }, {
                clazz: "Panel",
                id: "filepanelshare",
                _name: "fileshare"
            }, {
                clazz: "Panel",
                id: "filepanelprint",
                _name: "fileprint"
            }, {
                clazz: "Panel",
                id: "filepanelhelp",
                _name: "filehelp"
            }]
        },
        WO.ConfigTraveller(WO.MenuConfig, function(a) {
            a.clazz && a.id && (a._name = a._name || a.id)
        }),
        function(a) {
            var b;
            for (b = 0; b < a.buttons.length; b++)
                a.buttons[b].className = "wo-filetab-button wo-filetab-" + a.buttons[b].id;
            for (b = 0; b < a.panels.length; b++)
                a.panels[b].className = "wo-filetab-content wo-filetab-" + a.panels[b].id
        }(WO.MenuConfig)
    }(),
    WO.registerUI("widget/netdiskfinder", function() {
        function c(a, c) {
            function l() {
                function c() {
                    var c = b.val();
                    c && fio.file.mkdir({
                        path: f + c
                    }).then(function() {
                        return q(f)
                    }, function(a) {
                        "31061,file already exists" == a.message && alert("目录已存在")
                    }).then(function() {
                        l.onprogress = !1
                    }),
                    a.remove()
                }
                var a, b;
                return l.onprogress ? l.onprogress.select() : (a = $("<li>").addClass("netdisk-file-list-item dir").prependTo(h),
                b = $("<input>").attr("type", "text").addClass("new-dir-name fui-widget fui-selectable").val(WO.getLang("ui.newdir")).appendTo(a),
                l.onprogress = b[0],
                b[0].select(),
                b[0].focus(),
                b.on("keydown", function(b) {
                    13 == b.keyCode && c(),
                    27 == b.keyCode && (a.remove(),
                    l.onprogress = !1,
                    b.stopPropagation())
                }),
                void 0)
            }
            function m(a) {
                return a > 0 ? 1 : 0 > a ? -1 : 0
            }
            function n(a) {
                return a.isDir ? q(a.path) : (d.fire("fileclick", a),
                void 0)
            }
            function o(a) {
                return new Promise(function(b) {
                    h.transit({
                        x: a,
                        opacity: 0
                    }, 100, b)
                }
                )
            }
            function p() {
                return new Promise(function(a) {
                    h.css({
                        x: -parseInt(h.css("x"))
                    }).stop().transit({
                        x: 0,
                        opacity: 1
                    }, 100, a)
                }
                )
            }
            function q(a) {
                var b, c;
                return a = a || e,
                b = fio.file.list({
                    path: a
                }),
                c = o(-100 * m(a.length - f.length)),
                f = "/" == a.charAt(a.length - 1) ? a : a + "/",
                s(),
                Promise.all([b, c]).then(r, function() {})
            }
            function r(a) {
                h.empty();
                var b = a[0];
                b.sort(function(a, b) {
                    return a.isDir > b.isDir ? -1 : a.isDir == b.isDir ? a.createTime > b.createTime ? -1 : 1 : 1
                }),
                b.length ? $.each(b, function(a, b) {
                    (b.isDir || c && c(b)) && $("<li></li>").text(b.filename).addClass("netdisk-file-list-item").addClass(b.isDir ? "dir" : "file").data("file", b).appendTo(h)
                }) : h.append('<li class="empty" disabled="disabled">' + WO.getLang("ui.emptydir") + "</li>"),
                p(),
                u(),
                d.fire("cd", f, a[0])
            }
            function s() {
                function d(a) {
                    c += a + "/";
                    var b = $("<a></a>");
                    return a == e ? b.text(WO.getLang("ui.mydocument")) : b.text(a),
                    b.data("path", c)
                }
                var a, b, c;
                g.empty(),
                f != e && f != e + "/" ? g.append('<a class="dir-back">Back</a>') : g.append('<span class="my-document"></span>'),
                a = f.substr(e.length),
                b = a.split("/"),
                c = "",
                g.append(d(e)),
                $.each(b, function(a, b) {
                    b && (g.append('<span class="spliter"></span>'),
                    g.append(d(b)))
                }),
                g.append($('<a class="dir-refresh"></a>').data("path", f).text("刷新"))
            }
            function t(a) {
                return k = a,
                u()
            }
            function u() {
                var a = !1;
                return h.find(".netdisk-file-list-item").removeClass("selected").each(function() {
                    var b = $(this).data("file");
                    b && b.path == k && ($(this).addClass("selected"),
                    a = !0)
                }),
                a || (k = !1),
                a
            }
            function v() {
                return f
            }
            var j, k, d = b.setup({}), e = "/apps/wordonline", f = e, g = $('<div class="netdisk-nav"></div>').appendTo(a), h = $('<ul class="netdisk-file-list"></ul>').appendTo(a);
            return $("<a></a>").text(WO.getLang("ui.mkdir")).addClass("button netdisk-mkdir").click(l),
            j = $("<a></a>").text(WO.getLang("ui.mkdir")).addClass("button netdisk-mkdir").click(l),
            k = null ,
            g.after(j),
            a.addClass("netdisk-finder-container"),
            h.delegate(".netdisk-file-list-item", "click", function(a) {
                if (l.onprogress)
                    return l.onprogress.select();
                var b = $(a.target)
                  , c = b.data("file");
                c && n(c)
            }),
            g.delegate("a", "click", function(a) {
                if (l.onprogress)
                    return l.onprogress.select();
                if ($(a.target).hasClass("dir-back")) {
                    var b = f.split("/");
                    return b.pop(),
                    b.pop(),
                    q(b.join("/"))
                }
                q($(a.target).data("path"))
            }),
            WO.ready(function() {
                a.append($('<p class="login-tip"></p>').html(WO.getLang("ui.requirelogin"))),
                WO.doAfterLogin(function() {
                    q()
                }),
                fio.user.on("logout", function() {})
            }),
            WO.on("filerefresh", function() {
                q(f)
            }),
            d.list = q,
            d.select = t,
            d.pwd = v,
            d
        }
        var b = WO.getUI("eve");
        return {
            generate: c
        }
    }),
    WO.registerWouiHandler("filenew", function(a, b, c) {
        function h(a) {
            function d(d) {
                clearTimeout(c);
                try {
                    f.onload = f.onerror = function() {}
                    ,
                    f.src = ""
                } catch (e) {}
                g || (g = d,
                a(1 == d),
                b = !0),
                b || (a(1 == d),
                b = !0)
            }
            var b, c, f;
            g ? a(1 == g) : (f = new Image,
            f.onload = function() {
                d(!0)
            }
            ,
            f.onerror = function() {
                d(!1)
            }
            ,
            c = setTimeout(function() {
                d(!1)
            }, 300),
            f.src = e + "favicon.ico?v=" + +new Date)
        }
        function i(a, b) {
            if (a || a.length) {
                var c, e = ['<div class="tpl-list">'];
                $.each(a, function(a, d) {
                    e.push('<h2 class="filenew-title">' + d.name + "</h2>" + '<div class="filenew-main">' + '<ul class="tpl-list">'),
                    $.each(d.list, function(a, d) {
                        c = (b || WO.WO_URL) + "images/" + d.id + ".png",
                        e.push('<li class="tpl-item" data-title="' + d.title + '" data-id="' + d.id + '"><div class="tpl-thumbnails">' + (d.thumbs ? d.thumbs : '<img src="' + c + '" />') + '</div><div class="tpl-title">' + d.title + "</div></li>")
                    }),
                    e.push('<li class="tpl-item tpl-add" data-title="贡献模板" data-id="blank">   <div class="tpl-thumbnails" style="border-style:dashed;">       <p style="color: #CCC;font-size: 36px;text-align: center;margin-top: 40px;">+</p>   </div>   <div class="tpl-title">贡献模板</div></li>'),
                    e.push("</div></ul>")
                }),
                e.push("</div>"),
                d.find(".filenew-content").html(e.join(""))
            }
        }
        var g, d = $(b.getElement()), e = "http://wordonline.newoffline.bae.baidu.com/static/tpl/", f = WO.WO_URL + "tpl/";
        return d.html('<div class="filenew-wrap">   <div class="filenew-content">       <div class="tpl-list preload">           <h2 class="filenew-title">通用文档模板</h2>           <div class="filenew-main">               <ul class="tpl-list">                   <li class="tpl-item" data-title="空白文档" data-id="blank">                       <div class="tpl-thumbnails"><p style="color: #CCC;font-size: 24px;text-align: center;margin-top: 50px;">                           空白</p></div>                       <div class="tpl-title">空白文档</div>                   </li>                   <li class="tpl-item" data-title="调研方案" data-id="survey-scheme">                       <div class="tpl-thumbnails"><img                               src="' + f + 'images/survey-scheme.png"></div>' + '                       <div class="tpl-title">调研方案</div>' + "                   </li>" + '                   <li class="tpl-item" data-title="总体设计文档" data-id="design-document">' + '                       <div class="tpl-thumbnails"><img' + '                               src="' + f + 'images/design-document.png"></div>' + '                       <div class="tpl-title">总体设计文档</div>' + "                   </li>" + '                   <li class="tpl-item" data-title="项目迭代周报" data-id="projectiteration">' + '                       <div class="tpl-thumbnails"><img' + '                               src="' + f + 'images/projectiteration.png"></div>' + '                       <div class="tpl-title">项目迭代周报</div>' + "                   </li>" + '                   <li class="tpl-item" data-title="周报" data-id="weekly">' + '                       <div class="tpl-thumbnails"><img' + '                               src="' + f + 'images/weekly.png"></div>' + '                       <div class="tpl-title">周报</div>' + "                   </li>" + '                   <li class="tpl-item tpl-add" data-title="贡献模板" data-id="blank">' + '                       <div class="tpl-thumbnails" style="border-style:dashed;"><p' + '                               style="color: #CCC;font-size: 36px;text-align: center;margin-top: 40px;">+</p></div>' + '                       <div class="tpl-title">贡献模板</div>' + "                   </li>" + "               </ul>" + "           </div>" + "       </div>" + "   </div>" + "</div>"),
        h(function(a) {
            var b = a ? e : f;
            $.get(b + "tpl.php", {
                action: "config",
                noCache: +new Date
            }, function(a) {
                a && "SUCCESS" == a.state && a.list && i(a.list, b)
            }, "jsonp")
        }),
        d.delegate(".tpl-item", "click", function() {
            $(this).hasClass("tpl-add") ? WO.fire("confirm", {
                title: "贡献模板",
                textOk: "确定",
                message: '<p>欢迎贡献你的文档作为模板。<br/>发主题为“贡献模板 - 百度doc”的邮件到 <a href="mailto:ueditor@baidu.com?subject=贡献模板 - 百度doc邮件" target="blank">ueditor@baidu.com</a><br/>反馈问题请到 <a href="http://tieba.baidu.com/f?kw=%E7%99%BE%E5%BA%A6doc" target="blank">百度doc</a> 贴吧。感谢你的支持！'
            }) : (WO.menu.isOpen() && WO.menu.close(),
            WO.utils.openGetWin("#tpl=" + $(this).attr("data-id")))
        }),
        WO.on("newdoc", function(a) {
            var b = a ? "#tpl=" + a : "#tpl=blank";
            b = (window.DEBUG ? "./src.php" : "./") + b,
            WO.utils.openGetWin(b)
        }),
        WO.on("loadtemplate", function(a) {
            h(function(b) {
                var d = b ? e : f;
                $.get(d + "tpl.php", {
                    action: "tpl",
                    id: a,
                    noCache: +new Date
                }, function(b) {
                    if (b && "SUCCESS" == b.state && (c.setContent(b.html),
                    c.reset(),
                    c.focus(),
                    b.title)) {
                        var d = b.title;
                        d = d.substr(0, d.lastIndexOf(".")) || d,
                        d && "blank" != a && setTimeout(function() {
                            WO.fire("searchonwenku", d)
                        }, 1e3)
                    }
                }, "jsonp")
            })
        }),
        b
    }),
    WO.registerWouiHandler("fileopen", function(a, b, c) {
        function e() {
            var a = $("#openfromlocal-selector").find(".webuploader-pick");
            a && a.length || WebUploader.Uploader.support() && (WO.webuploader.on("filesQueued", function(a) {
                a[0] && a[0].source && a[0].source._refer.hasClass("fileopen-local-selector") && WO.menu.close()
            }),
            WO.webuploader.addButton({
                id: "#openfromlocal-selector",
                multiple: !1
            })),
            WebUploader.Uploader.support() || $("#openfromlocal-selector").on("click", function() {
                WO.fire("needflash")
            })
        }
        function i() {
            var a = WO.doc.current()
              , b = a && a.path || "";
            return b.substr(b.lastIndexOf("/") + 1)
        }
        function j(a) {
            try {
                document.title = a ? a + " - 百度Doc" : "百度Doc"
            } catch (b) {}
        }
        var f, g, h, d = $(b.getElement());
        return d.html('<div class="fileopen-wrap">   <div class="fileopen-content">       <h2 class="fileopen-title">打开</h2>       <div class="panel-left">           <div id="openfromwangpan" class="fileopen-subtab fileopen-active">百度云存储</div>           <div id="openfromlocal" class="fileopen-subtab fileopen-btn">从本地上传</div>       </div>       <div class="panel-right">           <div id="openfromwangpan-content" class="fileopen-subpanel fileopen-wangpan fileopen-active login-required"></div>           <div id="openfromlocal-content" class="fileopen-subpanel fileopen-local">               <div class="fileopen-subhead"><span class="fileopen-subtitle">从本地上传</span></div>               <div class="webuploader-wrap"><a id="openfromlocal-selector" class="fileopen-local-selector">选择文件...</a><span>支持格式 .doc, .docx</span></div>           </div>       </div>   </div></div>'),
        d.find(".fileopen-subtab").on("click", function() {
            var b = $(this)
              , c = $("#" + b.attr("id") + "-content");
            $(".fileopen-subtab").not(b).removeClass("fileopen-active"),
            b.addClass("fileopen-active"),
            $(".fileopen-subpanel").not(c).removeClass("fileopen-active"),
            c.addClass("fileopen-active"),
            "openfromlocal" == b.attr("id") && e()
        }),
        f = WO.basePath = "/apps/wordonline/",
        g = WO.getUI("widget/netdiskfinder"),
        h = g.generate($(".fileopen-wangpan", d).html(""), function(a) {
            return ".wo" == a.extension || ".doc" == a.extension || ".docx" == a.extension || a.isDir
        }),
        h.on("fileclick", function(a) {
            var b = UE.browser.ie ? "&nodl" : "";
            ".doc" == a.extension || ".docx" == a.extension ? WO.utils.openGetWin("./readonly.html#path=" + encodeURI(a.path.substr(f.length)) + b) : WO.utils.openGetWin((window.DEBUG ? "./src.php" : "./") + "#path=" + encodeURI(a.path.substr(f.length)) + b)
        }),
        WO.on("openmenu", function(a, b) {
            $("#fileopen,#openfromwangpan").trigger("click"),
            WO.menu.isOpen() || WO.menu.open(),
            b && b.preventDefault()
        }),
        WO.on("opendoc", function(a) {
            WO.menu.close(),
            WO.READONLY ? WO.doc.view({
                path: a
            }, function(a) {
                a.html ? c.setContent(a.html || "", !1, !0) : a.bdjson && c.setWkContent(a.bdjson["document.xml"]),
                a.path && j(i())
            }) : WO.doc.open({
                path: a
            }, function(a) {
                if (a.html)
                    c.setContent(a.html || "", !1, !0);
                else if (a.bdjson) {
                    c.setWkContent(a.bdjson["document.xml"]);
                    var b = 0 === a.path.indexOf(f) ? a.path.substr(f.length) : a.path;
                    window.location.hash = "#path=" + encodeURI(b)
                }
                a.path && j(i()),
                setTimeout(function() {
                    var a = c.selection.getRange();
                    a.setStartAtFirst(c.body.firstChild).collapse().select()
                })
            })
        }),
        WO.on("openuploadeddoc", function(a) {
            WO.fire("confirm", {
                title: "",
                message: "文档上传成功，现在打开？",
                textOk: "打开",
                textCancel: "取消",
                onOk: function() {
                    var b = UE.browser.ie ? "&nodl" : "";
                    WO.utils.openGetWin("./readonly.html#path=" + encodeURI(0 === a.indexOf(f) ? a.substr(f.length) : a) + b)
                }
            })
        }),
        b
    }),
    WO.registerWouiHandler("filesave", function(a, b, c) {
        function l(a) {
            WO.menu.close(),
            o(c.getContent(), a)
        }
        function o(a, b) {
            n = a = a || c.getContent(),
            WO.doc.save({
                newpath: b || "",
                content: a
            }, function(a) {
                var b = p();
                a && "SUCCESS" == a.state ? (q(b),
                WO.isUnSave = !1) : q("* " + b)
            })
        }
        function p() {
            var a = WO.doc.current()
              , b = a && a.path || "";
            return b.substr(b.lastIndexOf("/") + 1)
        }
        function q(a) {
            try {
                document.title = a ? a + " - 百度Doc" : "百度Doc"
            } catch (b) {}
        }
        var e, f, g, h, i, j, k, m, n, d = $(b.getElement());
        return d.html('<div class="filesave-wrap">   <div class="filesave-content">       <h2 class="filesave-title">保存</h2>       <div class="panel-left">           <div id="savetowangpan" class="filesave-subtab filesave-active">百度云存储</div>           <div id="savetolocal" class="filesave-subtab">保存到本地</div>       </div>       <div class="panel-right">           <div id="savetowangpan-content" class="filesave-subpanel filesave-wangpan filesave-active">               <div class="netdisk-wrap login-required"></div>           </div>           <div id="savetolocal-content" class="filesave-subpanel filesave-local">               <div class="fileopen-subhead"><span class="filesave-subtitle">保存到本地</span></div>               <div id="savetolocal-selector" class="filesave-local-button"><a class="download-button">导出文档到本地</a><span>导出格式 .docx</span></div>           </div>       </div>   </div></div>'),
        d.find(".filesave-subtab").on("click", function() {
            var b = $(this)
              , c = $("#" + b.attr("id") + "-content");
            $(".filesave-subtab").not(b).removeClass("filesave-active"),
            b.addClass("filesave-active"),
            $(".filesave-subpanel").not(c).removeClass("filesave-active"),
            c.addClass("filesave-active")
        }),
        WO.menu.on("open", function() {
            var a, b = WO.doc.current();
            b && (a = b.path || "未命名文档",
            a = a.substring(a.lastIndexOf("/") + 1, a.lastIndexOf(".")),
            $(".netdisk-save-select input").val(a))
        }),
        d.find(".filesave-local-button .download-button").on("click", function() {
            WO.doc.download()
        }),
        WO.on("exportdoc", function() {
            WO.doc.download()
        }),
        e = [],
        f = "/apps/wordonline",
        g = $(".filesave-wangpan", d),
        h = WO.getUI("widget/netdiskfinder"),
        i = h.generate($(".filesave-wangpan .netdisk-wrap", d).html(""), function(a) {
            return ".wo" == a.extension || ".doc" == a.extension || ".docx" == a.extension || a.isDir
        }),
        i.on("fileclick", function(a) {
            g.find("input").val(a.name)
        }),
        i.on("cd", function(a, b) {
            f = a,
            e = b
        }),
        g.append('<div class="netdisk-save-select login-required">   <label>保存为</label>   <input placeholder="文件名" title="文件名" class="fui-widget fui-selectable">   <a class="button save-button">保存</a></div>'),
        j = g.find("input"),
        k = g.find(".save-button"),
        k.on("click", function() {
            var c, a = !1, b = j.val();
            return b ? (c = f + b + (/\.wo/.test(b) ? "" : ".wo"),
            c != WO.doc.current().path && $.each(e, function(c, d) {
                return d.filename == b + ".wo" ? (a = !0,
                !1) : void 0
            }),
            a ? WO.fire("confirm", {
                message: "文件名已存在，你要替换它吗？",
                textOk: "替换",
                textCancel: "取消",
                onOk: function() {
                    l(c)
                }
            }) : l(c),
            void 0) : !1
        }),
        WO.isUnSave = !1,
        WO.on("savedoc saveasdoc", function(a, b) {
            if (b && b.preventDefault(),
            WO.doc.current().path && "savedoc" == a) {
                WO.menu.isOpen() || WO.menu.close();
                var d = c.getContent();
                if (n == d)
                    return WO.showMsg({
                        content: "文档已保存",
                        timeout: 2e3
                    }),
                    void 0;
                o(d)
            } else
                WO.menu.isOpen() || WO.menu.open(),
                $("#filesave, #savetowangpan").trigger("click"),
                setTimeout(function() {
                    j.focus()
                })
        }),
        j.on("keydown", function(a) {
            "13" == a.keyCode && k.trigger("click")
        }),
        c.on("contentchange", function() {
            var a, d, b = WO.doc.current().path;
            if (b) {
                if (a = c.getContent(),
                n == a)
                    return;
                d = p(),
                $("#wordonline-filename").html("* " + d),
                q("* " + d),
                WO.isUnSave = !0,
                m && clearTimeout(m),
                m = setTimeout(function() {
                    o(),
                    m = 0
                }, 1e3)
            } else
                $("#wordonline-filename").html("* 未命名文档"),
                q("* 未命名文档"),
                a = c.getContent();
            n != a && (WO.isUnSave = !0)
        }),
        c.on("afterSetContent", function() {
            var a = p();
            WO.isUnSave = !1,
            q(a),
            $("#wordonline-filename").html(a),
            n = c.getContent()
        }),
        b
    }),
    WO.registerWouiHandler("fileshare", function(a, b, c) {
        function f() {
            var a = []
              , b = $(".share-list-wrap");
            WO.share.list(function(c) {
                e = c,
                c && c.length ? ($.each(c, function(b, c) {
                    var d = WO.WO_ROOT_URL + "share.php?id=" + c.sid;
                    a.push('<li class="share-list-item"><span class="share-filename">' + (c.path ? c.path.substr(c.path.lastIndexOf("/") + 1) : "未保存文件") + "</span>" + '<div class="share-links">' + '   <a class="share-link" target="_blank" href="' + d + '" title="' + d + '">查看分享</a>' + '   <a class="share-delete" data-link="' + d + '" data-sid="' + c.sid + '" title="删除分享">删除</a>' + "</div>" + "</li>")
                }),
                b.html(a.join("")),
                $(".share-tip").hide()) : $(".share-tip").show(),
                h()
            })
        }
        function h() {
            window._bd_share_config = {
                common: {
                    bdPic: "",
                    bdSnsKey: {},
                    bdMini: "2",
                    bdMiniList: [],
                    bdStyle: "1",
                    bdSize: "32"
                },
                share: {}
            },
            g || (UE.utils.loadFile(document, {
                src: "http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion=" + ~(-new Date / 36e5),
                tag: "script",
                type: "text/javascript",
                defer: "defer"
            }, function() {
                g = !0,
                bdShareJsLoading = !1,
                p()
            }),
            bdShareJsLoading = !0),
            g || bdShareJsLoading || p()
        }
        function k(a) {
            if ("none" !== j) {
                d.find(".panel-right").addClass("loading");
                var b = $("#public-share .share-body");
                m("none"),
                a && WO.share.rm({
                    id: i
                }, function() {
                    d.find(".panel-right").removeClass("loading"),
                    b.hide(),
                    j = "none"
                })
            }
        }
        function l(a) {
            "share" !== j && (m("public"),
            h(),
            a && n())
        }
        function m(a) {
            $("#share-select input[name=sharetype][value=" + a + "]").prop("checked", !0)
        }
        function n() {
            $(this).hasClass("wo-disabled") || (d.find(".panel-right").addClass("loading"),
            WO.share.add({
                content: WO.editor.getContent()
            }, function(a) {
                d.find(".panel-right").removeClass("loading"),
                a && a.sid && o(a)
            }))
        }
        function o(a) {
            var c, d, e, f, b = $("#public-share .share-body");
            i = a.sid,
            c = WO.WO_ROOT_URL + "share.php?id=" + a.sid,
            $("#share-url", b).val(c)[0].select(),
            $(".shareQrCode", b).attr("src", "http://qr.liantu.com/api.php?w=128&m=0&text=" + encodeURI(c)),
            d = window._bd_share_config.common,
            e = window._bd_share_main.init,
            f = a.path ? a.path.substring(a.path.lastIndexOf("/"), a.path.lastIndexOf(".")) : "未命名文档",
            d && e && (d.bdTitle = f,
            d.bdDesc = d.bdText = f + "- 我用「百度Doc」编辑的文档，快看看吧！",
            d.bdUrl = c,
            e && e()),
            b.show(),
            $("#share-url").focus()[0].select(),
            j = "share"
        }
        function p() {
            var b, a = WO.doc.current().fid;
            a && e && g && (b = !1,
            $.each(e, function(c, d) {
                return d.fid == a ? (b = !0,
                l(),
                o(d),
                !1) : void 0
            }),
            !b && k())
        }
        function r() {
            q.text("已复制").attr("disabled", "disabled"),
            $("#share-url").focus()[0].select(),
            setTimeout(function() {
                q.text("复制").removeAttr("disabled")
            }, 3e3)
        }
        var g, i, j, q, d = $(b.getElement()), e = [];
        return d.html('<div class="share-wrap">   <div class="share-content">       <h2 class="share-title">分享</h2>       <div class="panel-left">           <div id="share-current" class="share-subtab share-active">当前文档</div>           <div id="share-list" class="share-subtab">已分享</div>       </div>       <div class="panel-right login-required">           <div id="share-current-content" class="share-subpanel share-current-content share-active">               <div class="share-subhead"><span class="share-subtitle">分享当前文档</span></div>               <form id="share-select">                   <div id="shared-tip"></div>                   <fieldset id="no-share">                      <legend>                         <label><input name="sharetype" type="radio" value="none" checked />不分享</label>                     </legend>                      <div class="share-description">不分享当前文档</div>                  </fieldset>                  <fieldset id="public-share">                      <legend>                          <label><input name="sharetype" type="radio" value="public"/>公开分享</label>                      </legend>                      <div class="share-description">创建任何人可见的分享</div>                      <div class="share-body">                          <h3>文档 URL 地址：</h3>                          <p>                              <input id="share-url" type="url" />                              <button id="copy-share-url" data-clipboard-target="share-url" type="button">复制</button>                          </p>                          <p class="share-qr-code" title="http://naotu.baidu.com/viewshare.html?shareId=aqot71i9dk0g">                               <canvas width="128" height="128" style="display: none;"></canvas>                               <img class="shareQrCode" alt="Scan me!" src="" style="display: block;">                          </p>                          <h3>社交网络分享</h3>                          <p id="share-platform" class="bdsharebuttonbox">                              <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>                              <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>                              <a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a>                              <a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a>                              <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>                          </p>                      </div>                  </fieldset>                  <fieldset id="password-share" disabled>                      <legend>                          <label><input name="sharetype" type="radio" value="password" disabled />私密分享</label>                      </legend>                      <div class="share-description">创建需要密码才可见的分享</div>                      <div class="share-body">敬请期待！</div>                  </fieldset>                  <fieldset id="email-share" disabled>                      <legend>                          <label><input name="sharetype" type="radio" value="email" disabled />邮件邀请</label>                      </legend>                      <div class="share-description">创建指定人可见的分享，您还可以允许他们编辑</div>                      <div class="share-body">敬请期待！</div>                  </fieldset>               </form>           </div>           <div id="share-list-content" class="share-subpanel share-list-content">               <div class="share-subhead"><span class="share-subtitle">已分享</span></div>               <ul class="share-list-wrap"></ul>               <p class="share-tip">没有分享记录</p>           </div>           <p class="login-tip">请 <a class="login-button">登录</a> 后使用</p>       </div>   </div></div>'),
        d.find(".share-subtab").on("click", function() {
            var a = $(this)
              , b = $("#" + a.attr("id") + "-content");
            $(".share-subtab").not(a).removeClass("share-active"),
            a.addClass("share-active"),
            $(".share-subpanel").not(b).removeClass("share-active"),
            b.addClass("share-active"),
            "share-list" == a.attr("id") && f()
        }),
        d.find(".share-list-wrap").delegate(".share-delete", "click", function() {
            var b = $(this);
            b.parents(".share-list-item").slideUp(),
            WO.share.rm({
                id: b.attr("data-sid")
            }, function() {})
        }),
        d.find(".share-current-button").on("click", function() {
            $(this).hasClass("wo-disabled") || (d.find(".share-current-loding").addClass("loading"),
            WO.share.add({
                content: WO.editor.getContent()
            }, function(a) {
                if (d.find(".share-current-button").hide(),
                d.find(".share-current-loding").removeClass("loading").css("display", "inline-block"),
                d.find(".share-current-qrcode .share-current-bdshare").slideDown(),
                a) {
                    var b = location.href.replace(/\/[#\?].*$/, "/").replace(/\/[^/]*$/, "/") + "share.php?id=" + a.sid;
                    $(".share-current-link").html('分享链接: <a href="' + b + '" target="_blank">' + b + "</a>").css("display", "inline-block"),
                    $(".share-current-qrcode").html('<img src="http://qr.liantu.com/api.php?text=' + b + '" />')
                }
            }))
        }),
        WO.doAfterLogin(function() {
            f(),
            d.find(".share-current-button").removeClass("wo-disabled"),
            d.find(".share-current-body").show(),
            d.find(".share-current-tip").hide()
        }),
        WO.on("sharedoc", function(a, b) {
            b && b.preventDefault(),
            WO.menu.isOpen() || WO.menu.open(),
            $("#fileshare, #share-current").trigger("click")
        }),
        g = bdShareJsLoading = !1,
        i = "",
        j = "none",
        d.delegate("input[name=sharetype]", "click", function(a) {
            var b = {
                none: k,
                "public": l
            };
            b[a.target.value](!0)
        }),
        WO.on("afterlistshare doccurrentchange", p),
        q = $("#copy-share-url"),
        UE.browser.ie ? $("#copy-share-url").on("click", function() {
            window.clipboardData.setData("Url", window._bd_share_config.common.bdUrl),
            window.clipboardData.setData("Text", window._bd_share_config.common.bdUrl),
            r()
        }) : c.on("zeroclipboardready", function() {
            var c = new ZeroClipboard(document.getElementById("copy-share-url"),{
                hoverClass: "hover",
                activeClass: "active"
            });
            c.on("ready", function() {
                c.on("copy", function(a) {
                    var b = a.clipboardData;
                    b.setData("text/plain", window._bd_share_config.common.bdUrl)
                }),
                c.on("aftercopy", function() {
                    r()
                })
            })
        }),
        b
    }),
    WO.registerWouiHandler("fileprint", function() {
        WO.on("print", function(a, b) {
            WO.editor.execCommand("print"),
            b.preventDefault()
        })
    }),
    WO.registerWouiHandler("filehelp", function(a, b) {
        function g(a) {
            var g, h, i, b = "", d = "", e = !0;
            return b += '<div class="help-container">',
            b += '<h2 class="help-header">帮助</h2>',
            b += '<div class="help-article row">',
            $.each(a.split("\n"), function(a, c) {
                if (d = "",
                /^##/g.test(c)) {
                    e ? e = !1 : d += "</table>";
                    var f = c.replace(/^#+\s*/, "");
                    d += '<table class="shortcuts-table "><tr><td></td><td><h2 class="shortcuts-thead">' + f + "</h2></td>"
                } else
                    /\S/.test(c) && (d += '<tr class="shortcuts-tbody"><td class="shortcuts-group"><div class="shortcuts-keys right">',
                    g = c.split(":"),
                    h = g[0],
                    i = g[1],
                    h = h.replace(/\`(.+?)\`/g, '<span class="shortcuts-key label">$1</span>'),
                    d += h,
                    d += '</div></td><td class="shortcuts-desc">' + i + "</td>",
                    d += "</tr>");
                b += d
            }),
            b += "<table>",
            b += "</div>",
            b += "</div>"
        }
        var d = $(b.getElement())
          , e = d.find(".fui-panel-content")
          , f = WO.WO_URL + "dialogs/help/operation.txt";
        UE.browser.mac && (f = WO.WO_URL + "dialogs/help/operation-mac.txt"),
        $.ajax({
            type: "get",
            dataType: "text",
            url: f,
            success: function(a) {
                var c = g(a) || "";
                return e.append(c),
                b
            }
        })
    }),
    UE._wk_whitelist = {
        a: {
            href: !0
        },
        br: {
            type: !0
        },
        div: {},
        h1: {},
        h2: {},
        h3: {},
        h4: {},
        h5: {},
        h6: {},
        img: {
            src: !0,
            width: !0,
            height: !0,
            alt: !0,
            __trans: {
                c: "src",
                w: "width",
                h: "height"
            }
        },
        math: {},
        obj: {
            datatype: !0,
            data: !0,
            "bg-img": !0,
            alt: !0,
            width: !0,
            height: !0,
            type: !0
        },
        li: {},
        ol: {
            start: !0,
            type: !0
        },
        p: {
            datatype: !0
        },
        span: {},
        table: {},
        td: {
            rowspan: !0,
            colspan: !0,
            nowrap: !0
        },
        tr: {},
        ul: {
            start: !0,
            type: !0
        },
        sup: {},
        sub: {},
        ruby: {},
        rt: {},
        rbase: {},
        style: {}
    },
    function() {
        function a(a) {
            var b = {};
            return $.each(a, function(a, c) {
                var d;
                (d = c.baseStyle["p"]) && $.each($.isArray(d) ? d : [d], function(a, d) {
                    $.each(c.style[d], function(a, c) {
                        b[a] = c
                    })
                }),
                (d = c.baseStyle["span"]) && $.each($.isArray(d) ? d : [d], function(a, d) {
                    $.each(c.style[d], function(a, c) {
                        b[a] = c
                    })
                })
            }),
            "body{" + $.map(b, function(a, b) {
                return b + ":" + a + ";"
            }).join("") + "}"
        }
        var b = {
            setWkContent: function(b) {
                var d, e, f, c = this;
                UE.utils.cssRule("bdjsonBaseStyle", a(b), c.document),
                c.fireEvent("beforesetwkcontent", b),
                d = UE.parseDoc(b),
                e = d.node,
                c.filterWkInputRule(e),
                f = e.toHtml(),
                c.setContent(f),
                c.fireEvent("aftersetwkcontent", f)
            },
            addWkInputRule: function(a) {
                void 0 === this.wkInputRules && (this.wkInputRules = []),
                this.wkInputRules.push(a)
            },
            filterWkInputRule: function(a) {
                var b = this;
                b.wkInputRules && a.traversal(function(a) {
                    for (var d, c = 0; d = b.wkInputRules[c++]; )
                        d.call(b, a)
                })
            }
        };
        UE.utils.extend(UE.Editor.prototype, b)
    }(),
    UE.plugins["docparserfilters"] = function() {
        function c(a) {
            if ("obj" == a.tagName) {
                if (a.firstChild()) {
                    var b = UE.uNode.createElement("img");
                    b.setAttr("src", a.firstChild().data),
                    a.parentNode.insertBefore(b, a)
                }
                return a.parentNode.removeChild(a),
                1
            }
        }
        function e(a) {
            var c, b = a.getAttr("style");
            b && /font\-family\s*:\s*Wingdings/.test(b) && (c = a.innerText().charCodeAt(0),
            9 != c ? a.innerText(d[c] || "●") : a.innerText("     "),
            a.setStyle("font-family"))
        }
        function h(a) {
            var b = a.getAttr("style");
            b && a.setAttr("style", b.replace(/styleName\s*:\s*([^;]+);/gi, function(b, c) {
                switch (c) {
                case "quote":
                    a.tagName = "blockqoute"
                }
                return ""
            }))
        }
        function i(a) {
            var b = a.getAttr("style");
            b && /outlineLvl\s*:\s*(\d);?/i.test(b) && (a.tagName = "h" + (1 * RegExp.$1 + 1),
            a.setAttr("style", b.replace(/outlineLvl\s*:\s*(\d);?/i, "")))
        }
        function k(a) {
            var d, c = a.getAttr("style");
            c && (c = c.split(";"),
            d = {},
            b.each(c, function(a) {
                a && (a = a.split(":"),
                d[a[0]] = a[1])
            }),
            c = [],
            b.each(d, function(a, b) {
                c.push(b + ":" + a)
            }),
            a.setAttr("style", c.join(";")))
        }
        function l(a) {
            function c(a) {
                var c = 0;
                return b.each(a, function() {
                    c++
                }),
                c
            }
            function d(a, b) {
                var d, e, f;
                if (a.tagName != b.tagName)
                    return !1;
                if (d = a.attrs,
                e = b.attrs,
                c(d) != c(e))
                    return !1;
                for (f in d)
                    if (e[f].replace(/;$/, "") !== d[f].replace(/;$/, ""))
                        return !1;
                return !0
            }
            if ("span" == a.tagName)
                for (; (next = a.nextSibling()) && d(next, a); ) {
                    for (; next.firstChild(); )
                        a.appendChild(next.firstChild());
                    next.parentNode.removeChild(next)
                }
        }
        function m(a) {
            if ("span" == a.tagName && (style = a.getAttr("style"))) {
                if (/valign\s*:\s*(sup|sub);?/i.test(style))
                    return a.tagName = RegExp.$1,
                    a.setAttr("style", style.replace(/valign\s*:\s*(sup|sub);?/i, "")),
                    void 0;
                if (/font-style\s*:\s*italic;?/i.test(style))
                    return a.tagName = "em",
                    a.setAttr("style", style.replace(/font-style\s*:\s*italic;?/i, "")),
                    void 0;
                if (/font-weight\s*:\s*(\d+);?/i.test(style) && 1 * RegExp.$1 >= 700)
                    return a.tagName = "strong",
                    a.setAttr("style", style.replace(/font-weight\s*:\s*(\d+);?/i, "")),
                    void 0
            }
        }
        var d, a = this, b = UE.utils;
        a.addWkInputRule(function(a) {
            "element" == a.type && (i(a),
            h(a),
            k(a),
            "span" == a.tagName && e(a),
            l(a),
            m(a),
            1 === c(a))
        }),
        d = {
            61550: "●",
            61548: "■",
            61557: "◆",
            61618: "◇",
            61692: "√"
        }
    }
    ,
    function() {
        function f(d) {
            var m, f = d[e["tagName"]], h = d[e["className"]], i = d[e["children"]], k = arguments.callee, l = null ;
            if (!g(f)) {
                if (c)
                    throw new Error("Illegal tag, tag name is: " + f);
                return null
            }
            if (l = new a({
                type: "element",
                children: [],
                tagName: f
            }),
            h && l.setAttr("class", b.isArray(h) ? h.join(" ") : h),
            j(l, d),
            i)
                if (b.isArray(i))
                    $.each(i, function(a, b) {
                        var c = k(b);
                        c && l.appendChild(c)
                    });
                else if (b.isString(i))
                    l.appendChild(new a({
                        type: "text",
                        data: b.unhtml(i || "")
                    }));
                else {
                    if (!b.isObject(i))
                        throw new Error("unkonw child type");
                    m = k(i),
                    m && l.appendChild(m)
                }
            return l
        }
        function g(a) {
            return a in d
        }
        function h(a, c, d) {
            var f, i, j, n, k = [], l = [], m = [], e = a.getAttr("class");
            if (e = e ? b.trim(e).split(/\s+/) : [],
            e && e.length) {
                for (e = e.reverse(),
                f = 0; f < e.length; f++)
                    n = e[f],
                    n in c ? "s_" == n.substr(0, 2) ? l.push(c[n]) : m.push(c[n]) : k.push(n);
                i = (l.join(";") + ";").replace(/(^;)/, "").replace(/;{2,}/g, ";"),
                j = (m.join(";") + ";").replace(/(^;)/, "").replace(/;{2,}/g, ";"),
                (i || j) && a.setAttr("style", i + j),
                k.length ? a.setAttr("class", k.join(" ")) : a.setAttr("class")
            }
            if ("element" == a.type)
                for (f = 0; f < a.children.length; f++)
                    h(a.children[f], c, d)
        }
        function i(a) {
            var c = {};
            return b.each(a, function(a, d) {
                var e = [];
                b.each(a, function(a, c) {
                    /[\d\.]+px/.test(a) && (a = a.replace(/[\d]+\.[\d]*px/g, function(a) {
                        return parseInt(a) + "px"
                    })),
                    e.push(b.trim("" + c) + ":" + b.trim("" + a))
                }),
                c[d] = (e.join(";") + ";").replace(/(^;)/, "").replace(/;{2,}/g, ";")
            }),
            c
        }
        function j(a, c) {
            var e = d[a.tagName]
              , f = e["__trans"];
            b.each(c, function(b, d) {
                if (0 !== d.indexOf("__")) {
                    if (f && f[d]) {
                        var g = c[d];
                        delete c[d],
                        d = f[d],
                        c[d] = g,
                        g = null
                    }
                    e[d] && a.setAttr(d, c[d] + "")
                }
            })
        }
        var a = UE.uNode
          , b = UE.utils
          , c = !1
          , d = UE._wk_whitelist
          , e = {
            tagName: "t",
            className: "r",
            children: "c"
        };
        UE.parseDoc = function(c) {
            var d, j, k, e = [], g = "";
            if (c) {
                for (c = b.isArray(c) ? c : [c],
                j = new a({
                    children: [],
                    type: "root"
                }),
                k = 0; k < c.length; k++)
                    d = f(c[k]),
                    h(d, i(c[k].style), c[k].baseStyle),
                    j.appendChild(d),
                    e.push(d.toHtml());
                g = e.join("")
            } else
                alert("文档解析出错");
            return {
                html: g,
                node: j
            }
        }
    }()
}();
